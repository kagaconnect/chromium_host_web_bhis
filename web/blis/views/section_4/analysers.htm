<div class="FlexDisplay FlexColumn container"  style="margin:0px; padding:0px; height:100%;">
	<div class="FlexDisplay" style="background:#535FD7; height:48px; box-shadow:0 1px 2px rgba(0, 0, 0, 0.3);" >
		<div id="backBtn"  class="nav-button" >
			<i class="mdi mdi-apps"></i>
		</div>
		<div class="FlexDisplay">
			<span style="white-space:nowrap; overflow:hidden; text-overflow: ellipsis; font-weight:bold; font-size:12px; color:#ffffff; margin:auto 8px;">Basic Laboratory Information System v3.5</span>
		</div>
		<div class="FlexDisplay FlexGrow" style="height:100%;"></div>
		<div class="add-equipment dropdown" tooltip="add equipment" flow="left">
			<div class="nav-button transparent dropdown">
				<i class="mdi mdi-plus-network"></i>
			</div>
			<div class="submenu">
				<ul class="root"/>
			</div>
		</div>
	</div>
	<div class="FlexDisplay Flex ContentPage  inner-section FadeIn"  style="width:100%; height:1px;">
		<div class="FlexDisplay FlexBoxSizing-BorderBox" style="width:100%; height:100%; overflow: hidden; position:relative;">
			<div style="width:100%; height:100%; margin:16px 16px 16px 16px;">
				<div class="page-container Flex FlexColumn Overflow-Hidden inner-container Round Shadow" style="position:relative; height:calc(100% - 32px);  width:100%;">
					<div class="FlexDisplay FlexRow Divider-Bottom" style="height:32px; " >
						<h4 class="feature-title mt-0" style="margin:0px 0px 0px 12px; font-size: 12px; font-weight:normal;">ANALYSERS</h4>
					</div>
					<div class="FlexDisplay FlexColumn FlexBoxSizing-BorderBox" style="width:100%;  height:calc(100% - 32px); z-index:2;">
						<div class="FlexDisplay FlexColumn"  style="width:100%; min-height: 24px; max-height: 24px;">
							<div class="FlexDisplay FlexRow Divider-Bottom Overflow-Hidden " style="width:100%; padding:0px;">
								<div class="FlexDisplay Divider-Right" style="min-width:32px; max-width:32px; min-height: 32px; max-height: 32px; padding:7px 0px 0px 0px;"><span style="text-align:center; display:inline-block; width:100%; font-size:9px; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;"></div>
								<div class="FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; min-height: 32px; max-height: 32px; padding:7px 0px 0px 0px;"><span style="text-align:center; display:inline-block; width:100%; font-size:9px; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">VERSION</span></div>
								<div class="FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; min-height: 32px; max-height: 32px; overflow:hidden; padding:7px 8px 0px 8px; font-size:9px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">LAB SECTION</span></div>
								<div class="FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; min-height: 32px; max-height: 32px; overflow:hidden; padding:7px 8px 0px 8px; font-size:9px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">COMMUNICATION</span></div>
								<div class="FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; min-height: 32px; max-height: 32px; overflow:hidden; padding:7px 8px 0px 8px; font-size:9px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">FEED SOURCE</span></div>
								<div class="FlexDisplay" style="width:100%; min-height: 32px; max-height: 32px; overflow:hidden; padding:7px 8px 0px 8px; font-size:9px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">NAME</span></div>			
							</div>	
						</div>
						<div class="FlexDisplay FlexColumn FlexBoxSizing-BorderBox scroll scroll2 AnalysersList" style="overflow-y:auto; height:calc(100% - 56px);">
						</div>
						<div id="pagingBox" class="FlexDisplay Divider-Top FlexRow" style="width:100%; min-height:32px; max-height:32px;"></div>
					</div>			
				</div>
			</div>
		</div>
	</div>
</div>
<script>
	$('#backBtn').click(function(){
		var page = System.IO.Path.Combine("web","blis","views",backNavigation);
		loadSubPage(System.IO.Path.Combine(System.Environment.get_CurrentDirectory(),page), true);
	});
	
	function populateData(id, options){
		$(".AnalysersList").html('');
		
		var config_file = System.IO.Path.Combine("web","blis","configurations","analysers.json");
		if(System.IO.File.Exists(config_file)){
			var configs = JSON.parse(System.IO.File.ReadAllText(config_file));
			
			var _analysers = configs.filter(function(analyser){
				var _id = analyser.Name[0];
				if(_id >= 0 && _id <= 9)_id = "0_9";
				
				return _id.toUpperCase() == id.toUpperCase();
			});
			
			for(var x=0; x<_analysers.length; x++){
				var analyser = _analysers[x];
				
				var statusType = "mdi-map-marker";
				var statusColor = "#01579B";
				
				//if(item.Latitude == ""){
				//	statusType = "mdi-map-marker-off";
				//	statusColor = "red";
				//}
				
				var operating = "mdi-help-circle";
				var operatingColor = "#4A148C";
				
				/*if(item.OperatingStatus == "Closed"){
					operating = "mdi-cancel";
					operatingColor = "red";
				}
				else if(item.OperatingStatus == "Closed (Temporary)"){
					operating = "mdi-alert-circle";
					operatingColor = "#FFD600";
				}
				else if(item.OperatingStatus == "Operating" || item.OperatingStatus == "Opert"){
					operating = "mdi-check-circle";
					operatingColor = "#669900";
				}
				else if(item.OperatingStatus == "Pending Operation - Under Construction" || item.OperatingStatus == "Pending Operation - Construction Complete"){
					operating = "mdi-clock-alert";
					operatingColor = "#C51162";
				}*/
				
				var mappedType = "mdi-link-off";
				//if(item.IsMapped == "Yes")mappedType = "mdi-link";
				
				var Version = analyser.Version;
				var Lab_Section = analyser.LabSection;			
				var Communication_Type  = analyser.CommunicationType;
				var Feed_Source  = analyser.FeedSource;
				var Equipment_Name  = analyser.Name;
				var Config_File  = analyser.ConfigFile;
				
				var analyzer = '<div data-feed="'+Feed_Source+'" class="FlexDisplay FlexRow Divider-Bottom Overflow-Hidden CheckBoxBold" style="width:100%; min-width:100%; min-height: 32px; max-height: 32px;" >'; 
					analyzer += '	<div tooltip="'+Config_File+'" flow="right" class="FlexDisplay Divider-Right" style="min-width:32px; max-width:32px; height:100%; padding:0px 0px 0px 0px;"><span style="text-align:center; display:inline-block; width:100%;"><i class="mdi '+operating+'"></i></span></div>';
					analyzer += '	<div class="FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; height:100%; padding:8px 0px 0px 0px;"><span style="text-align:center; display:inline-block; width:100%; font-size:11px; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">'+Version+'</span></div>';
					analyzer += '	<div class="FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; width:100%; height:100%; overflow:hidden; padding:8px 8px 0px 8px; font-size:11px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1.3;">'+Lab_Section+'</span></div>';
					analyzer += '	<div class="FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; width:100%; height:100%; overflow:hidden; padding:8px 8px 0px 8px; font-size:11px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1.3;">'+Communication_Type+'</span></div>';
					analyzer += '	<div class="FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; width:100%; height:100%; overflow:hidden; padding:8px 8px 0px 8px; font-size:11px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1.3;">'+Feed_Source+'</span></div>';
					analyzer += '	<div class="FlexDisplay" style="width:100%; height:100%; overflow:hidden; padding:8px 8px 0px 8px; font-size:11px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1.3;">'+Equipment_Name+'</span></div>';						
					analyzer += '	<div onclick="event.stopPropagation(); edit_analyser(this)" class="FlexDisplay" tooltip="Edit" flow="left" style="cursor:pointer; min-height: 32px; max-height: 32px; padding:0px 8px 0px 8px; font-size:20px;"><i class="mdi mdi-square-edit-outline" style="margin:0px; padding:0px;"></i></div>';
					analyzer += '	<div onclick="event.stopPropagation(); settings_analyser(this)" class="FlexDisplay" tooltip="Settings" flow="left" style="cursor:pointer; min-height: 32px; max-height: 32px; padding:0px 8px 0px 8px; font-size:20px;"><i class="mdi mdi-cogs" style="margin:0px; padding:0px;"></i></div>';
					analyzer += '	<div onclick="event.stopPropagation(); delete_analyser(this)" class="FlexDisplay" tooltip="Delete" flow="left" style="cursor:pointer; min-height: 32px; max-height: 32px; padding:0px 8px 0px 8px; font-size:20px;"><i class="mdi mdi-delete-sweep" style="margin:0px; padding:0px;"></i></div>';
					analyzer += '</div>';	
					
				$(".AnalysersList").append(analyzer);
			}
		}		
	}
	
	function settings_analyser(item){
		hideNavigationDropMenu();
		
		var content = '';
			content += '<div class="bar-container" style="margin:0px;">';
			content += '	<div class="bar-progress"></div>';
			content += '</div>';
			
			content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px;  margin-top:4px; margin-bottom:8px; padding:2px 8px;">';						
			content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
			content += '			<div tooltip="" flow="left" class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
			content += '				<div class="icon" style="padding-top:0px;">';	
			content += '					<i class="mdi mdi-cellphone-link" />';	
			content += '				</div>';	
			content += '				<input type="text" placeholder="Name"  class="name-input" style="padding:0px 0px 0px 8px;"/>';	
			content += '			</div>';
			content += '		</div>';
			content += '	</div>';			
			content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; margin-bottom:8px; padding:2px 8px;">';						
			content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
			content += '			<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
			content += '				<div class="icon" style="padding-top:0px;">';	
			content += '					<i class="mdi mdi-file-link" />';	
			content += '				</div>';	
			content += '				<input type="text" placeholder="Configuration File"  class="config-file-input" style="padding:0px 0px 0px 8px;"/>';	
			content += '				<div class="enter-value icon btn-color Divider-Left scan"  style="border-radius: 0 0px 0px 0; padding:1px 0px 0px 1px; min-width:32px; max-width:32px;">';
			content += '					<i class="mdi mdi-playlist-plus" />';
			content += '				</div>';
			content += '			</div>';
			content += '		</div>';
			content += '	</div>';
			
			
			content += '</div>';


		var ana_dlg = ShowDialog('<i class="mdi mdi-file-tree"></i>', "Equipment settings", content,{
			onCloseDialog : function() {
				ana_dlg = null;
				return false; 
			}
		},"320px");
	}
	
	function edit_analyser(item){
	
	}
	
	function delete_analyser(item){
	
	}
	
	function lab_section_selected(item){
	
	}
	
	function communication_type_selected(item){
	
	}
	
	function hideNavigationDropMenu(){
		$(".add-equipment .submenu").hide();
		$(".add-equipment").attr('id', '');
	}
	
	function preparePager(){
		$("#pagingBox").html('');

		var pages = '';
		pages += '<div id="Page_0_9" class="Animation-3ms FlexDisplay Flex FlexGrow FlexRow Button NonStandard Pager Disabled" style="height:32px;">';
		pages += '	<span class="text" style="text-align:center; display:inline-block; width:100%; font-size:11px; margin:2px 0px 0px 0px;">0-9</span>';
		pages += '</div>';

		var selected = "Page_";
		for(x=65;x<65+26;x++){
			var c = String.fromCharCode(x);
			pages += '<div id="Page_'+c+'" class="Animation-3ms FlexDisplay Flex FlexGrow FlexRow Button NonStandard Pager Divider-Left Disabled" style="height:32px;">';
			pages += '	<span class="text" style="text-align:center; display:inline-block; width:100%; font-size:11px; margin:2px 0px 0px 0px;">'+c+'</span>';
			pages += '</div>';
		}
		$("#pagingBox").html(pages);
	}
	
	function fakeData(){
		preparePager();
		
		var config_file = System.IO.Path.Combine("web","blis","configurations","analysers.json");
		if(System.IO.File.Exists(config_file)){
			var configs = JSON.parse(System.IO.File.ReadAllText(config_file));
			
			var pagerList = [];
			for(var x=0; x<configs.length; x++){
				var config = configs[x];
				
				var id = config.Name[0];
				
				if(id >= 0 && id <= 9)id = "0_9";
				if(pagerList.indexOf(id) == -1)pagerList.push(id);
			}
			pagerList.sort();
			
			for(var x=0; x<pagerList.length; x++){
				var id = pagerList[x];
				
				$('#Page_'+id).removeClass('Disabled');						
				$('#Page_'+id).off("click");
				$('#Page_'+id).click(function(){
					if(!$(this).hasClass('Disabled')){
						$("#pagingBox").find('.Pager').each(function(){
							$(this).removeClass('Selected');
						});
						$(this).addClass('Selected');
						
						var _id = $(this).attr('id').replace('Page_','');	
						populateData(_id);
					}
				});
				
				if(x==0){
					$('#Page_'+id).addClass('Selected');
					populateData(id);
				}
			}
		}	
	}
	
	$(".add-equipment").unbind( "click" );
	$(".add-equipment").click(function(){	
		hideNavigationDropMenu();
		
		var content = '';
			content += '<div class="bar-container" style="margin:0px;">';
			content += '	<div class="bar-progress"></div>';
			content += '</div>';
			
			content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px;  margin-top:4px; margin-bottom:8px; padding:2px 8px;">';						
			content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
			content += '			<div tooltip="" flow="left" class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
			content += '				<div class="icon" style="padding-top:0px;">';	
			content += '					<i class="mdi mdi-monitor-cellphone-star" />';	
			content += '				</div>';
			content += '				<select class="connectionType">';
			content += '					<option selected="">Connection Type</option>';
			content += '					<option>TCP/IP</option>';
			content += '					<option>Serial</option>';
			content += '					<option>File</option>';
			content += '					<option>Data Source</option>';
			content += '				</select>';
			content += '			</div>';
			content += '		</div>';
			content += '	</div>';
			content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px;  margin-top:4px; margin-bottom:8px; padding:2px 8px;">';						
			content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
			content += '			<div tooltip="" flow="left" class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
			content += '				<div class="icon" style="padding-top:0px;">';	
			content += '					<i class="mdi mdi-cellphone-link" />';	
			content += '				</div>';	
			content += '				<input type="text" placeholder="Name"  class="name-input" style="padding:0px 0px 0px 8px;"/>';	
			content += '			</div>';
			content += '		</div>';
			content += '	</div>';
			content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px;  margin-top:4px; margin-bottom:8px; padding:2px 8px;">';						
			content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
			content += '			<div tooltip="" flow="left" class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
			content += '				<div class="icon" style="padding-top:0px;">';	
			content += '					<i class="mdi mdi-cellphone-link" />';	
			content += '				</div>';	
			content += '				<input type="text" placeholder="Version"  class="version-input" style="padding:0px 0px 0px 8px;"/>';	
			content += '			</div>';
			content += '		</div>';
			content += '	</div>';
			content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px;  margin-top:4px; margin-bottom:8px; padding:2px 8px;">';						
			content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
			content += '			<div tooltip="" flow="left" class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
			content += '				<div class="icon" style="padding-top:0px;">';	
			content += '					<i class="mdi mdi-flask-outline" />';	
			content += '				</div>';
			content += '				<select class="labSections" onchange="lab_section_selected(this)">';
			content += '					<option selected="">Lab Section</option>';
			content += '				</select>';			
			content += '			</div>';
			content += '		</div>';
			content += '	</div>';
			content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px;  margin-top:4px; margin-bottom:8px; padding:2px 8px;">';						
			content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
			content += '			<div tooltip="" flow="left" class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
			content += '				<div class="icon" style="padding-top:0px;">';	
			content += '					<i class="mdi mdi-arrow-decision" />';	
			content += '				</div>';
			content += '				<select class="CommunicationType" onchange="communication_type_selected(this)">';
			content += '					<option selected="">Communication Type</option>';
			content += '					<option>Bi-directional</option>';
			content += '					<option>Uni-directional</option>';
			content += '				</select>';
			content += '			</div>';
			content += '		</div>';
			content += '	</div>';
			content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; margin-bottom:8px; padding:2px 8px;">';						
			content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
			content += '			<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
			content += '				<div class="icon" style="padding-top:0px;">';	
			content += '					<i class="mdi mdi-file-link" />';	
			content += '				</div>';	
			content += '				<input type="text" placeholder="Configuration File"  class="config-file-input" style="padding:0px 0px 0px 8px;"/>';	
			content += '				<div class="enter-value icon btn-color Divider-Left scan"  style="border-radius: 0 0px 0px 0; padding:1px 0px 0px 1px; min-width:32px; max-width:32px;">';
			content += '					<i class="mdi mdi-playlist-plus" />';
			content += '				</div>';
			content += '			</div>';
			content += '		</div>';
			content += '	</div>';
			
			
			content += '</div>';


		var ana_dlg = ShowDialog('<i class="mdi mdi-file-tree"></i>', "Add equipment", content,{
			onCloseDialog : function() {
				ana_dlg = null;
				return false; 
			}
		},"320px");	
		
		$(ana_dlg.el).find(".enter-value").unbind( "click" );
		$(ana_dlg.el).find(".enter-value").click(function() {
			/*var _name = $(ana_dlg.el).find(".name-input").val().trim();
			var _description = $(ana_dlg.el).find(".description-input").val().trim();
			if(_name.length > 0){
			
				var config_file = System.IO.Path.Combine("web","blis","configurations","specimen_types.json");
				if(System.IO.File.Exists(config_file)){
					var configs = JSON.parse(System.IO.File.ReadAllText(config_file));
			
					var id = _name[0].toUpperCase();
					if(id >= 0 && id <= 9)id = "0_9";
					
					var exists = false;
					for(var x=0; x<configs.length; x++){
						var config = configs[x];
						if(_name.trim().toLowerCase() == config.Name.trim().toLowerCase()){
							exists = true;
							break;
						}
					}
					
					if(!exists && _name.length > 1){
						_name = _name.charAt(0).toUpperCase() + _name.slice(1);
						
						if(_description.length > 1){
							_description = _description.charAt(0).toUpperCase() + _description.slice(1);
						}
						else if(_description.length == 1){
							_description = _description.charAt(0).toUpperCase();
						}
						
						configs.push({
							"Name":_name,
							"Description":_description,
							"CompatibleTests":[]
						});
						
						System.IO.File.WriteAllText(config_file,JSON.stringify(configs));
						
						$('#Page_'+id).removeClass('Disabled');	
						$("#pagingBox").find('.Pager').each(function(){
							$(this).removeClass('Selected');
						});			
						$('#Page_'+id).addClass('Selected');
						
						populateData(configs, id);
						
						ana_dlg.toggle();
						ana_dlg = null;
						
					}
					else{ //baby aspirate
						var item = $(ana_dlg.el).find(".name-input");
						if(item != undefined && item != null){
							item.parent().addClass("is-invalid");
							item.parent().attr("tooltip","Specimen type already exists");
							item.focus(function(){
								$(this).parent().removeClass("is-invalid");
								$(this).parent().attr("tooltip","");
							});
						}
					}
					
					
				}
			}*/
		});
		
		create_custom_dropdowns();
	
		var _labSections = $(dlg.el).find(".select-dropdown.labSections").find(".list");
		if(_labSections != undefined && _labSections != null){
			_labSections.addClass("scroll scroll2");
			_labSections.css({"overflow-y": "auto", "max-height": "200px"});
		}
	});

	$(".add-specimen-type").mouseup(function(){
		return false;
	});
	$(".submenu").mouseup(function(){
		return false;
	});

	$('.add-specimen-type .submenu .root .nav-button').each(function (index, value) {
		$(this).click(function(){
			
		});
	});

	hideNavigationDropMenu();
	
	fakeData();
	
	closeLoadingPage();
	
</script>