<div class="FlexDisplay FlexColumn container"  style="margin:0px; padding:0px; height:100%;">
	<div class="FlexDisplay" style="background:#535FD7; height:48px; box-shadow:0 1px 2px rgba(0, 0, 0, 0.3);" >
		<div id="backBtn"  class="nav-button" >
			<i class="mdi mdi-apps"></i>
		</div>
		<div class="FlexDisplay">
			<span class="BLIS-Title" style="white-space:nowrap; overflow:hidden; text-overflow: ellipsis; font-weight:normal; font-size:12px; color:#ffffff; margin:auto 8px;">Basic Laboratory Information System</span>
		</div>
		<div class="FlexDisplay FlexGrow" style="height:100%;"></div>
		<div class="add-drug dropdown" tooltip="add drug" flow="left">
			<div class="nav-button transparent dropdown">
				<i class="mdi mdi-pill"></i>
			</div>
			<div class="submenu">
				<ul class="root"/>
			</div>
		</div>
	</div>
	<div class="FlexDisplay Flex ContentPage  inner-section FadeIn"  style="width:100%; height:1px;">
		<div class="FlexDisplay FlexBoxSizing-BorderBox" style="width:100%; height:100%; overflow: hidden; position:relative;">
			<div style="width:100%; height:100%; margin:16px 16px 16px 8px;">
				<div class="page-container Flex FlexColumn Overflow-Hidden inner-container Round Shadow" style="position:relative; height:calc(100% - 32px);  width:100%;">
					<div class="FlexDisplay FlexRow Divider-Bottom" style="height:32px; " >
						<h4 class="feature-title mt-0" style="margin:0px 0px 0px 12px; font-size: 12px; font-weight:normal;">DRUGS</h4>
					</div>
					<div class="FlexDisplay FlexColumn FlexBoxSizing-BorderBox" style="width:100%;  height:calc(100% - 32px); z-index:2;">
						<div class="FlexDisplay FlexColumn"  style="width:100%; min-height: 24px; max-height: 24px;">
							<div class="FlexDisplay FlexRow Divider-Bottom Overflow-Hidden " style="width:100%; padding:0px;">
								<div class="FlexDisplay Divider-Right" style="min-width:32px; max-width:32px; min-height: 32px; max-height: 32px; padding:7px 0px 0px 0px;"><span style="text-align:center; display:inline-block; width:100%; font-size:9px; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;"></div>
								<div class="FlexDisplay Divider-Right" style="min-width:128px; max-width:128px; min-height: 24px; max-height: 24px; overflow:hidden; padding:7px 8px 0px 12px; font-size:9px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">NAME</span></div>
								<div class="FlexDisplay" style="width:100%; min-height: 24px; max-height: 24px; overflow:hidden; padding:7px 8px 0px 12px; font-size:9px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">DESCRIPTION</span></div>				
							</div>	
						</div>
						<div class="FlexDisplay FlexColumn FlexBoxSizing-BorderBox scroll scroll2 DrugsList" style="overflow-y:auto; height:calc(100% - 56px);">
						
						</div>
						<div id="pagingBox" class="FlexDisplay Divider-Top FlexRow" style="width:100%; min-height:32px; max-height:32px;"></div>
					</div>			
				</div>
			</div>
		</div>
	</div>
</div>
<script>

$("#backBtn").unbind( "click" );
$('#backBtn').click(function(){
	var page = System.IO.Path.Combine("web","blis","views",backNavigation);
	loadSubPage(System.IO.Path.Combine(System.Environment.get_CurrentDirectory(),page), true);
});

function hideNavigationDropMenu(){
	$(".add-drug .submenu").hide();
	$(".add-drug").attr('id', '');
}


function proceedTo(item, index){
	var navigateFrom = $('.animated-sub-page.active');
	var indexFrom = navigateFrom.data("path").replace("section-","");	
	
	navigateFrom.removeClass('transition-enter');
	navigateFrom.removeClass('transition-grow');
	navigateFrom.removeClass('transition-shrink');
	navigateFrom.removeClass('transition-enter-right');
	navigateFrom.removeClass('transition-enter-left');
	navigateFrom.addClass('transition-busy');
	navigateFrom.addClass('transition-shrink');
	
	setTimeout(function(){
		if(index != indexFrom){					
			var navigateTo = $("#mainPage").find(`[data-path='section-${index}']`);
										
			navigateFrom.removeClass('transition-busy');
			navigateFrom.removeClass('transition-enter');
			navigateFrom.removeClass('transition-grow');
			navigateFrom.removeClass('transition-shrink');
			navigateFrom.removeClass('transition-enter-right');
			navigateFrom.removeClass('transition-enter-left');
			if(indexFrom < index) navigateFrom.addClass('transition-leave-left');
			else navigateFrom.addClass('transition-leave-right');
			  
			navigateTo.removeClass('transition-busy');
			navigateTo.removeClass('transition-leave');
			navigateTo.removeClass('transition-grow');
			navigateTo.removeClass('transition-shrink');
			navigateTo.removeClass('transition-leave-right');
			navigateTo.removeClass('transition-leave-left');
			if(indexFrom < index) navigateTo.addClass('transition-enter-right');
			else navigateTo.addClass('transition-enter-left');
			
			navigateFrom.removeClass("active");
			navigateTo.addClass('active');
		}
		else {
			navigateFrom.one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(e) {
				navigateFrom.removeClass('transition-shrink');
				navigateFrom.removeClass('transition-grow');
			});
			
			navigateFrom.addClass('transition-grow');					
		}
	}, 500);
}

function preparePager(){
	$("#pagingBox").html('');

	var pages = '';
	pages += '<div id="Page_0_9" class="Animation-3ms FlexDisplay Flex FlexGrow FlexRow Button NonStandard Pager Disabled" style="height:32px;">';
	pages += '	<span class="text" style="text-align:center; display:inline-block; width:100%; font-size:11px; margin:2px 0px 0px 0px;">0-9</span>';
	pages += '</div>';

	var selected = "Page_";
	for(x=65;x<65+26;x++){
		var c = String.fromCharCode(x);
		pages += '<div id="Page_'+c+'" class="Animation-3ms FlexDisplay Flex FlexGrow FlexRow Button NonStandard Pager Divider-Left Disabled" style="height:32px;">';
		pages += '	<span class="text" style="text-align:center; display:inline-block; width:100%; font-size:11px; margin:2px 0px 0px 0px;">'+c+'</span>';
		pages += '</div>';
	}
	$("#pagingBox").html(pages);
}

function edit_drug(item){
	var name = $(item).parent().find(".DrugName").text();
	var description = $(item).parent().find(".DrugDescription").text();
	
	var content = '';
		content += '<div class="bar-container" style="margin:0px;">';
		content += '	<div class="bar-progress"></div>';
		content += '</div>';
		
		content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; margin-bottom:8px; padding:2px 8px;">';						
		content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
		content += '			<div tooltip="" flow="left" class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
		content += '				<div class="icon" style="padding-top:0px;">';	
		content += '					<i class="mdi mdi-flask-outline" />';	
		content += '				</div>';	
		content += '				<input type="text" placeholder="Name" value="'+name+'" class="name-input" style="padding:0px 0px 0px 8px;"/>';	
		content += '			</div>';
		content += '		</div>';
		content += '	</div>';
		content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; margin-bottom:8px; padding:2px 8px;">';						
		content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
		content += '			<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
		content += '				<div class="icon" style="padding-top:0px;">';	
		content += '					<i class="mdi mdi-flask-outline" />';	
		content += '				</div>';	
		content += '				<input type="text" placeholder="Description" value="'+description+'" class="description-input" style="padding:0px 0px 0px 8px;"/>';	
		content += '				<div class="enter-value icon btn-color Divider-Left scan"  style="border-radius: 0 0px 0px 0; padding:1px 0px 0px 1px; min-width:32px; max-width:32px;">';
		content += '					<i class="mdi mdi-playlist-plus" />';
		content += '				</div>';
		content += '			</div>';
		content += '		</div>';
		content += '	</div>';
		
		
		content += '</div>';


	var spt_dlg = ShowDialog('<i class="mdi mdi-pill"></i>', "Edit drug", content,{
		onCloseDialog : function() {
			spt_dlg = null;
			return false; 
		}
	},"320px");	
	
	$(spt_dlg.el).find(".enter-value").unbind( "click" );
	$(spt_dlg.el).find(".enter-value").click(function() {
		var _name = $(spt_dlg.el).find(".name-input").val().trim();
		var _description = $(spt_dlg.el).find(".description-input").val().trim();
		if(_name.length > 0){
		
			var config_file = System.IO.Path.Combine("web","blis","configurations","drugs.json");
			if(System.IO.File.Exists(config_file)){
				var configs = JSON.parse(System.IO.File.ReadAllText(config_file));

				for(var x=0; x<configs.length; x++){
					var config = configs[x];
					if(name.trim().toLowerCase() == config.Name.trim().toLowerCase()){
						
						_name = _name.charAt(0).toUpperCase() + _name.slice(1);
					
						if(_description.length > 1){
							_description = _description.charAt(0).toUpperCase() + _description.slice(1);
						}
						else if(_description.length == 1){
							_description = _description.charAt(0).toUpperCase();
						}
						
						config.Name = _name;
						config.Description = _description;
						
						System.IO.File.WriteAllText(config_file,JSON.stringify(configs));
						
						var id = _name[0].toUpperCase();
						populateData(configs, id);
											
						spt_dlg.toggle();
						spt_dlg = null;						
						
						break;
					}
				}			
			}
		}
	});
}

function delete_drug(item){
	var name = $(item).parent().find(".DrugName").text();
	var config_file = System.IO.Path.Combine("web","blis","configurations","drugs.json");
	
	
	var content = '';
		content += '<div class="bar-container" style="margin:0px;">';
		content += '	<div class="bar-progress"></div>';
		content += '</div>'; 
		
		content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:48px; margin-bottom:8px; padding:2px 8px;">';						
		content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
		content += '			<h4 class="feature-title mt-0" style="margin:auto auto; font-size: 12px; font-weight:normal;">Are you sure you want to delete drug "'+name+'"</h4>';
		content += '		</div>';
		content += '	</div>';
		content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:56px; margin-bottom:8px; padding:2px 8px;">';						
		content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
		content += '			<div class="FlexDisplay" style="margin:auto auto;">';
		content += '				<div class="yesButton button button-primary" style="margin:0px 4px 0px 0px;">Yes</div>';
		content += '				<div class="noButton button button-primary" style="margin:0px 0px 0px 4px;">No</div>';
		content += '			</div>';
		content += '		</div>';
		content += '	</div>';
		
		
		content += '</div>';


	var spt_dlg = ShowDialog('<i class="mdi mdi-pill"></i>', "Delete specimen type", content,{
		onCloseDialog : function() {
			spt_dlg = null;
			return false; 
		}
	},"400px");	
	
	$(spt_dlg.el).find(".yesButton").unbind( "click" );
	$(spt_dlg.el).find(".yesButton").click(function() {
		if(System.IO.File.Exists(config_file)){
			var configs = JSON.parse(System.IO.File.ReadAllText(config_file));

			for(var x=0; x<configs.length; x++){
				var config = configs[x];
				if(name.trim().toLowerCase() == config.Name.trim().toLowerCase()){
					configs.splice(x, 1);
					
					System.IO.File.WriteAllText(config_file,JSON.stringify(configs));
					
					var id = name[0].toUpperCase();
					if(id >= 0 && id <= 9)id = "0_9";
					
					var hasItems = false;
					for(var x=0; x<configs.length; x++){
						var config = configs[x];
						var _id = config.Name[0].toUpperCase();
						if(id == _id){
							hasItems = true;
							break;
						}
					}
					
					if(hasItems){
						populateData(configs, id);
					}
					else{
						$('#Page_'+id).addClass('Disabled');
						$("#pagingBox").find('.Pager').each(function(){
							$(this).removeClass('Selected');
						});
						
						var _id = "0_9";
						var foundOne = false;
						$("#pagingBox").find('.Pager').each(function(){
							if(!$(this).hasClass('Disabled')){
								if(!foundOne){
									foundOne = true;
									_id = $(this).attr('id').replace('Page_','');
								}
							}
						});	
						
						$('#Page_'+_id).addClass('Selected');
						populateData(configs, _id);
					}
					
					
					
					//var id = _name[0].toUpperCase();
					//populateData(configs, id);
										
					spt_dlg.toggle();
					spt_dlg = null;						
					
					break;
				}
			}		
		}
	});
	
	$(spt_dlg.el).find(".noButton").unbind( "click" );
	$(spt_dlg.el).find(".noButton").click(function() {
		spt_dlg.toggle();
		spt_dlg = null;		
	});
	
}

function add_drug(name, description){
	var drug  = '<div class="FlexDisplay FlexRow Divider-Bottom Overflow-Hidden " style="width:100%; padding:0px; min-height: 32px; max-height: 32px;">';
		drug += '	<div class="FlexDisplay Divider-Right" style="min-width:32px; max-width:32px; height:100%; padding:0px 0px 0px 0px;"><span style="text-align:center; display:inline-block; width:100%;"><i class="mdi mdi-help-circle"></i></span></div>';
		drug += '	<div class="DrugName FlexDisplay Divider-Right" style="min-width:128px; max-width:128px; min-height: 32px; max-height: 32px; overflow:hidden; padding:12px 8px 0px 12px; font-size:9px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">'+name+'</span></div>';
		drug += '	<div class="DrugDescription FlexDisplay" style="width:100%; min-height: 32px; max-height: 32px; overflow:hidden; padding:12px 8px 0px 12px; font-size:9px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">'+description+'</span></div>';	
		drug += '	<div onclick="edit_drug(this)" class="FlexDisplay" tooltip="Edit" flow="left" style="cursor:pointer; min-height: 32px; max-height: 32px; padding:0px 8px 0px 8px; font-size:20px;"><i class="mdi mdi-square-edit-outline" style="margin:0px; padding:0px;"></i></div>';
		drug += '	<div onclick="delete_drug(this)" class="FlexDisplay" tooltip="Delete" flow="left" style="cursor:pointer; min-height: 32px; max-height: 32px; padding:0px 8px 0px 8px; font-size:20px;"><i class="mdi mdi-delete-sweep" style="margin:0px; padding:0px;"></i></div>';
		drug += '</div>';

	$(".DrugsList").append(drug);
}

function populateData(configs, id){
	$(".DrugsList").html('');
	
	for(var x=0; x<configs.length; x++){
		var config = configs[x];
		var _id = config.Name[0];
		if(id == _id){
			add_drug(config.Name, config.Description);
		}
	}
}

function populateTests(){
	$(".TestsList").html('');
	
	for(var x=0; x<40; x++){
		
		var test = '<div class="FlexDisplay Divider-Bottom FlexRow" style="min-height:32px; max-height:32px;">';
			test += '	<div class="FlexDisplay " style="min-width:32px; max-width:32px; height:100%; padding:0px 0px 0px 0px;">';
			test += '		<input type="checkbox" id="checkbox_'+x+'" class="checkbox" style="display: none;">';
			test += '		<label for="checkbox_'+x+'" class="check">';
			test += '		  <svg width="18px" height="18px" viewBox="0 0 18 18">';
			test += '			<path d="M1,9 L1,3.5 C1,2 2,1 3.5,1 L14.5,1 C16,1 17,2 17,3.5 L17,14.5 C17,16 16,17 14.5,17 L3.5,17 C2,17 1,16 1,14.5 L1,9 Z"></path>';
			test += '			<polyline points="1 9 7 14 15 4"></polyline>';
			test += '		  </svg>';
			test += '		</label>';
			test += '	</div>	';							
			test += '	<div class="feature-content" style=" overflow:hidden; margin:-2px 12px 0px 0px;">';
			test += '		<span class="feature-title mt-0" style="font-size:12px; font-weight:normal; white-space:nowrap; width:100%; text-overflow:ellipsis; -webkit-line-clamp:1; color:#6B7A90;">Test '+x+'</span>';
			test += '	</div>';
			test += '</div>';

		$(".TestsList").append(test);
	}	
}

function loadData(){

	preparePager();

	var config_file = System.IO.Path.Combine("web","blis","configurations","drugs.json");
	if(System.IO.File.Exists(config_file)){
		var configs = JSON.parse(System.IO.File.ReadAllText(config_file));
		
		var pagerList = [];
		for(var x=0; x<configs.length; x++){
			var config = configs[x];
			var id = config.Name[0];
			if(id >= 0 && id <= 9)id = "0_9";
			
			if(pagerList.indexOf(id) == -1)pagerList.push(id);
		}
		pagerList.sort();
		
		for(var x=0; x<pagerList.length; x++){
			var id = pagerList[x];
			
			$('#Page_'+id).removeClass('Disabled');						
			$('#Page_'+id).off("click");
			$('#Page_'+id).click(function(){
				if(!$(this).hasClass('Disabled')){
					configs = JSON.parse(System.IO.File.ReadAllText(config_file));
					
					$("#pagingBox").find('.Pager').each(function(){
						$(this).removeClass('Selected');
					});
					$(this).addClass('Selected');
					
					var _id = $(this).attr('id').replace('Page_','');	
					populateData(configs, _id);
				}
			});
			
			if(x==0){
				$('#Page_'+id).addClass('Selected');
				populateData(configs, id);
			}
		}
		
	}
}

$(".add-drug").unbind( "click" );
$(".add-drug").click(function(){	
	hideNavigationDropMenu();
	
	var content = '';
		content += '<div class="bar-container" style="margin:0px;">';
		content += '	<div class="bar-progress"></div>';
		content += '</div>';
		
		content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; margin-top:4px; margin-bottom:8px; padding:2px 8px;">';						
		content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
		content += '			<div tooltip="" flow="left" class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
		content += '				<div class="icon" style="padding-top:0px;">';	
		content += '					<i class="mdi mdi-flask-outline" />';	
		content += '				</div>';	
		content += '				<input type="text" placeholder="Name"  class="name-input" style="padding:0px 0px 0px 8px;"/>';	
		content += '			</div>';
		content += '		</div>';
		content += '	</div>';
		content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; margin-bottom:8px; padding:2px 8px;">';						
		content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
		content += '			<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
		content += '				<div class="icon" style="padding-top:0px;">';	
		content += '					<i class="mdi mdi-flask-outline" />';	
		content += '				</div>';	
		content += '				<input type="text" placeholder="Description"  class="description-input" style="padding:0px 0px 0px 8px;"/>';	
		content += '				<div class="enter-value icon btn-color Divider-Left scan"  style="border-radius: 0 0px 0px 0; padding:1px 0px 0px 1px; min-width:32px; max-width:32px;">';
		content += '					<i class="mdi mdi-playlist-plus" />';
		content += '				</div>';
		content += '			</div>';
		content += '		</div>';
		content += '	</div>';
		
		
		content += '</div>';


	var spt_dlg = ShowDialog('<i class="mdi mdi-pill"></i>', "Add specimen type", content,{
		onCloseDialog : function() {
			spt_dlg = null;
			return false; 
		}
	},"320px");	
	
	$(spt_dlg.el).find(".enter-value").unbind( "click" );
	$(spt_dlg.el).find(".enter-value").click(function() {
		var _name = $(spt_dlg.el).find(".name-input").val().trim();
		var _description = $(spt_dlg.el).find(".description-input").val().trim();
		if(_name.length > 0){
		
			var config_file = System.IO.Path.Combine("web","blis","configurations","drugs.json");
			if(System.IO.File.Exists(config_file)){
				var configs = JSON.parse(System.IO.File.ReadAllText(config_file));
		
				var id = _name[0].toUpperCase();
				if(id >= 0 && id <= 9)id = "0_9";
				
				var exists = false;
				for(var x=0; x<configs.length; x++){
					var config = configs[x];
					if(_name.trim().toLowerCase() == config.Name.trim().toLowerCase()){
						exists = true;
						break;
					}
				}
				
				if(!exists && _name.length > 1){
					_name = _name.charAt(0).toUpperCase() + _name.slice(1);
					
					if(_description.length > 1){
						_description = _description.charAt(0).toUpperCase() + _description.slice(1);
					}
					else if(_description.length == 1){
						_description = _description.charAt(0).toUpperCase();
					}
					
					configs.push({
						"Name":_name,
						"Description":_description
					});
					
					System.IO.File.WriteAllText(config_file,JSON.stringify(configs));
					
					$('#Page_'+id).removeClass('Disabled');	
					$("#pagingBox").find('.Pager').each(function(){
						$(this).removeClass('Selected');
					});			
					$('#Page_'+id).addClass('Selected');
					
					populateData(configs, id);
					
					spt_dlg.toggle();
					spt_dlg = null;
					
				}
				else{ //baby aspirate
					var item = $(spt_dlg.el).find(".name-input");
					if(item != undefined && item != null){
						item.parent().addClass("is-invalid");
						item.parent().attr("tooltip","Specimen type already exists");
						item.focus(function(){
							$(this).parent().removeClass("is-invalid");
							$(this).parent().attr("tooltip","");
						});
					}
				}
				
				
			}
		}
	});
	
});

$(".add-drug").mouseup(function(){
	return false;
});
$(".submenu").mouseup(function(){
	return false;
});

$('.add-drug .submenu .root .nav-button').each(function (index, value) {
	$(this).click(function(){
		
	});
});



//populateTests();
loadData();

hideNavigationDropMenu();

closeLoadingPage();	
</script>