<div class="FlexDisplay FlexColumn container"  style="margin:0px; padding:0px; height:100%;">
	<div class="FlexDisplay" style="background:#535FD7; height:48px; box-shadow:0 1px 2px rgba(0, 0, 0, 0.3);" >
		<div id="backBtn"  class="nav-button" >
			<i class="mdi mdi-apps"></i>
		</div>
		<div class="FlexDisplay">
			<span class="BHIS-Title" style="white-space:nowrap; overflow:hidden; text-overflow: ellipsis; font-weight:normal; font-size:12px; color:#ffffff; margin:auto 8px;">Basic Laboratory Information System</span>
		</div>
		<div class="FlexDisplay FlexGrow" style="height:100%;"></div>
	</div>
	<div class="FlexDisplay FlexColumn FlexBoxSizing-BorderBox FadeIn animated-sub-pages"  style="width:100%; height:calc(100% - 48px); position:relative;">
		
			<div class="animated-sub-page FlexColumn FlexBoxSizing-BorderBox active" data-path="section-0"   style="width:100%; height:calc(100% - 0px);  overflow: hidden; display: block;">
				<div class="FlexDisplay Flex FlexGrow" style="margin:16px 16px 16px 16px; min-height:80px; max-height:80px;">
					<div class="page-container Flex FlexColumn Overflow-Hidden inner-container Round Shadow" style="position:relative; height:calc(100% - 0px);  width:100%;">
					
						<div class="FlexDisplay FlexColumn FlexBoxSizing-BorderBox" style="width:100%;  height:calc(100% - 0px); z-index:2;">
							<div class="FlexDisplay FlexColumn"  style="width:100%; height:calc(100% - 32px);">
								<div class="FlexDisplay FlexRow Overflow-Hidden " style="width:100%; padding:0px;">
									
									<div class="FlexDisplay FlexRow Flex"  style="min-width:130px; margin:8px 8px 0px 8px;">						
										<div class="FlexDisplay Flex">
											<div class="FlexDisplay Flex FlexRow form-control" style="padding:0px 0px 0px 8px;">
												<input id="patient_search_text" type="text" placeholder="Search"/>
												<div id="patient_search_button" class="icon btn-color Divider-Left"  style="border-radius: 0 4px 4px 0;">
													<i class="mdi mdi-account-search" />
												</div>
												
											</div>
										</div>
									</div>
										
								</div>	
							</div>
							<div id="patientsPagingBox" class="FlexDisplay Divider-Top FlexRow" style="width:100%; min-height:32px; max-height:32px;"></div>
						</div>
						
					</div>
				</div>

				<div class="FlexDisplay Flex FlexGrow" style="height:calc(100% - 96px);">
					<div class="scroll scroll2" style="position:relative; height:calc(100% - 0px);  width:100%; padding:0px 8px 0px 8px;">
				
						<div class="FlexDisplay FlexColumn Overflow-Hidden info-card">
							<div class="FlexDisplay FlexRow pic" style="height:calc(100% - 0px);">	
								<div class="FlexDisplay FlexColumn credentials">
									<div style="display:block; font-size:13px; height:18px; line-height:1.2; margin:4px 8px 0px 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
										Fredrick L. Mwasekaga
									</div>
								</div>
							</div>
							<div class="FlexDisplay FlexRow info">
								<div onclick="proceedTo(this,1)" class="FlexDisplay icon" tooltip='Edit' flow='up-right' style="margin-left:8px;">
									<i class="mdi mdi-account-edit" />
								</div>
								<div class="FlexDisplay Flex"  style="height:100%;">
								</div>
								<div class="FlexDisplay icon" tooltip='Visits: 100 ' flow='up-left'>
									<i class="mdi mdi-hospital-building" />
								</div>
								<div class="FlexDisplay icon" tooltip='Gender: Male' flow='up-left'>
									<i class="mdi mdi-gender-male-female" />
								</div>
								<div class="FlexDisplay icon" tooltip='DOB: 1985-12-01' flow='up-left'>
									<i class="mdi mdi-calendar" />
								</div>
							</div>	
						</div>
				
					</div>
				</div>
			</div>
			<div class="animated-sub-page FlexColumn FlexBoxSizing-BorderBox scroll scroll2" data-path="section-1"   style="width:100%; height:calc(100% - 0px); overflow-x:hidden; display: block;">
				
				<div class="FlexDisplay FlexBoxSizing-BorderBox" style="width:100%; height:100%; overflow: hidden; position:relative;">
					<div class="FlexDisplay FlexBoxSizing-BorderBox FormArea" style="min-width:272px; max-width:272px;  height:100%; overflow: hidden; position:relative;">
						<div class="FlexBoxSizing-BorderBox active" style="padding:16px 0px 16px 16px; height:100%; min-width:256px; max-width:256px;">
							<div class="page-container Flex FlexColumn Overflow-Hidden inner-container Round Shadow" style="position:relative;  height:calc(100% - 0px); width:100%;">
								<div class="FlexDisplay FlexColumn FlexBoxSizing-BorderBox" style="width:100%; height:calc(100% - 0px);  z-index:2;">
									<div class="FlexDisplay FlexRow Divider-Bottom" style="height:32px; " >
										<h4 class="feature-title mt-0" style="margin:0px 0px 0px 12px; font-size: 12px; font-weight:normal;">FACILITY</h4>
									</div>
									<div class="FlexDisplay Flex Overflow-Hidden Divider-Bottom" style="padding:0px 0px 0px 0px;  min-width:240px; max-width:240px;">
										<div id="mapid" style="width: 100%; height: 100%;"></div>
									</div>
									<div class="FlexDisplay FlexColumn" style="min-height:216px; padding:8px 8px 8px 8px" >
										<div class="FlexDisplay FlexRow"  style="width:100%; height:40px; padding:4px 0px; 0px 0px">						
											<div class="FlexDisplay Flex">
												<div class="FlexDisplay Flex FlexRow form-control" style="padding:0px 0px 0px 8px;">
													<input id="facility_search_text" type="text" placeholder="Search"/>
													<div id="facility_search_button" class="icon btn-color Divider-Left"  style="border-radius: 0 4px 4px 0;">
														<i class="mdi mdi-map-search" />
													</div>
													
												</div>
											</div>
										</div>
										<div class="FlexDisplay FlexRow"  style="width:100%; height:40px; padding:4px 0px; 0px 0px">						
											<div class="FlexDisplay Flex">
												<div class="FlexDisplay Flex FlexRow form-control" style="padding:0px 0px 0px 8px;">
													<input id="facility_name_text" type="text" placeholder="Name" disabled/>
												</div>
											</div>
										</div>
										<div class="FlexDisplay FlexRow"  style="width:100%; height:40px; padding:4px 0px; 0px 0px">						
											<div class="FlexDisplay Flex">
												<div class="FlexDisplay Flex FlexRow form-control" style="padding:0px 0px 0px 8px;">
													<input id="facility_region_text" type="text" placeholder="Region" disabled/>
												</div>
											</div>
										</div>
										<div class="FlexDisplay FlexRow"  style="width:100%; height:40px; padding:4px 0px; 0px 0px">						
											<div class="FlexDisplay Flex">
												<div class="FlexDisplay Flex FlexRow form-control" style="padding:0px 0px 0px 8px;">
													<input id="facility_district_text" type="text" placeholder="District" disabled/>
												</div>
											</div>
										</div>
										<div class="FlexDisplay FlexRow"  style="width:100%; height:40px; padding:4px 0px; 0px 0px">						
											<div class="FlexDisplay Flex">
												<div class="FlexDisplay Flex FlexRow form-control" style="padding:0px 0px 0px 8px;">
													<input id="facility_type_text" type="text" placeholder="Type" disabled/>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div style="width:100%; height:100%; margin:16px 16px 16px 0px;">
						<div class="page-container Flex FlexColumn Overflow-Hidden inner-container Round Shadow" style="position:relative; height:calc(100% - 32px);  width:100%;">
							<div class="FlexDisplay FlexRow Divider-Bottom" style="height:32px; " >
								<h4 class="feature-title mt-0" style="margin:0px 0px 0px 12px; font-size: 12px; font-weight:normal;">RECEPTION</h4>
								<div class="FlexDisplay FlexGrow" style="height:100%;"></div>
								
								
								<div onclick="proceedTo(this,0)" class="FlexDisplay btn-clear" tooltip="search" flow="down">
									<div style="margin:auto auto; width:16px height:16px; padding:0px 16px 0px 8px;">
										<i class="mdi mdi-account-search" />
									</div>
								</div>
								<div class="FlexDisplay btn-clear search" tooltip="look up" flow="down">
									<div style="margin:auto auto; width:16px height:16px; padding:0px 16px 0px 8px;">
										<i class="mdi mdi-text-box-search-outline" />
									</div>
								</div>
								<div class="FlexDisplay btn-clear clear" tooltip="clear" flow="down">
									<div style="margin:auto auto; width:16px height:16px; padding:0px 16px 0px 8px;">
										<i class="mdi mdi-rotate-left" />
									</div>
								</div>
								<div class="FlexDisplay btn-clear save" tooltip="save" flow="left">
									<div style="margin:auto auto; width:16px height:16px; padding:0px 16px 0px 8px;">
										<i class="mdi mdi-check-circle" />
									</div>
								</div>			
								
								
							</div>
							<div class="FlexDisplay FlexColumn FlexBoxSizing-BorderBox" style="width:100%;  height:calc(100% - 32px); z-index:2; position:relative;">						
								<div class="FlexColumn FlexBoxSizing-BorderBox scroll scroll2" style="width:100%; height:100%; overflow-y:auto; overflow-x:hidden; display: block;">						
									<div class="FlexDisplay FlexColumn FlexBoxSizing-BorderBox FormArea" style="width:100%; margin:0px 0px 16px 0px;">
										<div class="FlexDisplay FlexRow Divider-Bottom" style="background:#182538;min-height:32px;max-height:32px;margin:0px 0px 2px 0px;" >
											<div style="font-size:14px; margin:0px 0px 0px 12px;">
												<i class="mdi mdi-card-account-details-outline" style="height:100%; color:white;" />
											</div>
											<div class="FlexDisplay Flex" style="min-width:150px;">
												<h4 class="feature-title mt-0" style="margin:8px 0px 8px 10px; font-size: 12px; font-weight:normal; line-height:16px;">General Information</h4>
											</div>
										</div>
										
										<div class="FlexDisplay FlexRow" style="min-height:16px;max-height:16px;margin:8px 0px 8px 0px;" >
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 12px; font-size: 12px; font-weight:normal; line-height:16px;">Reference Number</h4>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 10px; font-size: 12px; font-weight:normal; line-height:16px;">Patient Number</h4>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 4px; font-size: 12px; font-weight:normal; line-height:16px;">National ID</h4>
											</div>
										</div>
										<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; padding:0px 8px;">						
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px;">
													<div class="icon">
														<i class="mdi mdi-arrow-decision-outline" />
													</div>
													<input class="ReferenceNumber" type="text" placeholder="Reference Number"/>
												</div>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-badge-account-outline" />
													</div>
													<input class="PatientNumber" type="text" placeholder="Patient Number"/>
												</div>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 0px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-badge-account-outline" />
													</div>
													<input class="NationalID" type="text" placeholder="National ID"/>
												</div>
											</div>
										</div>
										
										<div class="FlexDisplay FlexRow" style="min-height:16px;max-height:16px;margin:8px 0px 0px 0px;" >
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 12px; font-size: 12px; font-weight:normal; line-height:16px;">First Name</h4>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 10px; font-size: 12px; font-weight:normal; line-height:16px;">Middle Name</h4>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 4px; font-size: 12px; font-weight:normal; line-height:16px;">Last Name</h4>
											</div>
										</div>
										<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; padding:0px 8px;">						
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px;">
													<div class="icon">
														<i class="mdi mdi-account" />
													</div>
													<input class="FirstName" type="text" placeholder="First Name"/>
												</div>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-account" />
													</div>
													<input class="MiddleName" type="text" placeholder="Middle Name"/>
												</div>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 0px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-account" />
													</div>
													<input class="LastName" type="text" placeholder="Last Name"/>
												</div>
											</div>
										</div>
										
										<div class="FlexDisplay FlexRow" style="min-height:16px;max-height:16px;margin:8px 0px 0px 0px;" >
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 12px; font-size: 12px; font-weight:normal; line-height:16px;">Gender</h4>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 10px; font-size: 12px; font-weight:normal; line-height:16px;">Date Of Birth</h4>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 4px; font-size: 12px; font-weight:normal; line-height:16px;">Phone Number</h4>
											</div>
										</div>
										<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; padding:0px 8px;">						
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<div class="Flex btn-group btn-group-toggle gender" data-toggle="buttons" style="margin:0px 4px 0px 0px;">
													<label class="btn btn-color" tooltip="Ambiguous" flow="right">
														<input value="A" type="radio" name="gender_options" autocomplete="off"><div style="width:8px; height:8px; margin:auto auto;">A</div>
													</label>
													<label class="btn btn-color" tooltip="Female" flow="up">
														<input value="F" type="radio" name="gender_options" autocomplete="off"><div style="width:8px; height:8px; margin:auto auto;">F</div>
													</label>
													<label class="btn btn-color" tooltip="Male" flow="up">
														<input value="M" type="radio" name="gender_options" autocomplete="off"><div style="width:8px; height:8px; margin:auto auto;">M</div>
													</label>
													<label class="btn btn-color" tooltip="Not applicable" flow="up">
														<input value="N" type="radio" name="gender_options" autocomplete="off"><div style="width:8px; height:8px; margin:auto auto;">N</div>
													</label>
													<label class="btn btn-color" tooltip="Other" flow="up">
														<input value="O" type="radio" name="gender_options" autocomplete="off"><div style="width:8px; height:8px; margin:auto auto;">O</div>
													</label>
													<label class="btn btn-color" tooltip="Unknown" flow="up">
														<input value="U" type="radio" name="gender_options" autocomplete="off" value=""><div style="width:8px; height:8px; margin:auto auto;">U</div>
													</label>
												</div>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-calendar-outline" />
													</div>
													<input type="text" placeholder="yyyy-mm-dd" class="datepicker-range-dob" style="padding:0px 0px 0px 8px;"/>
													<div id="age-manual" class="icon btn-color Divider-Left"  style="border-radius: 0 4px 4px 0; min-width:32px; max-width:32px;">
														<i class="mdi mdi-calendar-search" />
													</div>
												</div>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-cellphone-basic" />
													</div>
													<input id="phone_number" type="text" placeholder="Phone Number"/>
												</div>
											</div>
										</div>
										
										<div class="FlexDisplay FlexRow" style="min-height:16px;max-height:16px;margin:8px 0px 0px 0px;" >
											<div class="FlexDisplay Flex FlexGrow-2" style="min-width:260px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 12px; font-size: 12px; font-weight:normal; line-height:16px;">Address</h4>
											</div>
											<div class="FlexDisplay Flex FlexGrow" style="min-width:130px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 4px; font-size: 12px; font-weight:normal; line-height:16px;">Email</h4>
											</div>
										</div>
										<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; padding:0px 8px;">
											<div class="FlexDisplay Flex FlexGrow-2" style="min-width:260px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-earth" />
													</div>
													<input class="Address" type="text" placeholder="Address"/>
												</div>
											</div>
											<div class="FlexDisplay Flex FlexGrow" style="min-width:130px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-at" />
													</div>
													<input id="email_address" type="text" placeholder="Address"/>
												</div>
											</div>
										</div>
									</div>
									<div class="FlexDisplay FlexColumn Flex FlexBoxSizing-BorderBox Divider-Top FormArea" style="width:100%; margin:8px 0px 8px 0px;">
										<div class="FlexDisplay FlexRow Divider-Bottom" style="background:#182538;min-height:32px;max-height:32px;margin:0px 0px 2px 0px;" >
											<div style="font-size:14px; margin:0px 0px 0px 12px;">
												<i class="mdi mdi-flask" style="height:100%; color:white;" />
											</div>
											<div class="FlexDisplay Flex" style="min-width:150px;">
												<h4 class="feature-title mt-0" style="margin:8px 0px 8px 10px; font-size: 12px; font-weight:normal; line-height:16px;">Specimen</h4>
											</div>
										</div>
										
										<div class="FlexDisplay FlexRow" style="min-height:16px;max-height:16px;margin:8px 0px 0px 0px;" >
											<div class="FlexDisplay Flex" style="min-width:150px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 10px; font-size: 12px; font-weight:normal; line-height:16px;">Condition</h4>
											</div>
											<div class="FlexDisplay Flex" style="min-width:160px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 10px; font-size: 12px; font-weight:normal; line-height:16px;">Priority</h4>
											</div>
										</div>
										<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; padding:0px 8px;">						
											<div class="FlexDisplay Flex" style="min-width:150px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-contrast" />
													</div>
													<select class="SpecimenCondition">
														<option value="Choose..." selected="">Choose...</option>
														<option value="Good">Good</option>
														<option value="Suitable">Suitable</option>
														<option value="Unsuitable">Unsuitable</option>
														<option value="Unacceptable">Unacceptable</option>
													</select>
												</div>
											</div>
											<div class="FlexDisplay Flex" style="min-width:160px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-clock-fast" />
													</div>
													<select class="SpecimenPriority">
														<option value="Choose..." selected="">Choose...</option>
														<option value="Routine">Routine</option>
														<option value="Stat">Stat</option>
														<option value="Urgent">Urgent</option>
														<option value="Xferred">Xferred</option>
													</select>
												</div>
											</div>
										</div>
										
										<div class="FlexDisplay FlexRow" style="min-height:16px;max-height:16px;margin:8px 0px 0px 0px;" >
											<div class="FlexDisplay Flex" style="min-width:150px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 12px; font-size: 12px; font-weight:normal; line-height:16px;">Collected Date</h4>
											</div>
											<div class="FlexDisplay Flex">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 10px; font-size: 12px; font-weight:normal; line-height:16px; white-space: nowrap;">Collected By</h4>
											</div>
										</div>
										<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; padding:0px 8px;">						
											<div class="FlexDisplay Flex" style="min-width:150px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px;">
													<div class="icon">
														<i class="mdi mdi-calendar-outline" />
													</div>
													<input type="text" placeholder="yyyy-mm-dd hh:mm" class="datepicker-range-specimen-collected" style="padding:0px 0px 0px 8px;"/>
												</div>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-doctor" />
													</div>
													<input class="SpecimenCollectedBy" type="text" placeholder="Specimen Collected By"/>
												</div>
											</div>
										</div>
										
										<!--<div class="FlexDisplay FlexRow" style="min-height:16px;max-height:16px;margin:8px 0px 0px 0px;" >
											<div class="FlexDisplay Flex" style="min-width:150px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 12px; font-size: 12px; font-weight:normal; line-height:16px;">Sent Date</h4>
											</div>
											<div class="FlexDisplay Flex">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 10px; font-size: 12px; font-weight:normal; line-height:16px; white-space: nowrap;">Sent By</h4>
											</div>
										</div>
										<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; padding:0px 8px;">						
											<div class="FlexDisplay Flex" style="min-width:150px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px;">
													<div class="icon">
														<i class="mdi mdi-calendar-outline" />
													</div>
													<input type="text" placeholder="yyyy-mm-dd hh:mm" class="datepicker-range-specimen-sent" style="padding:0px 0px 0px 8px;"/>
												</div>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-doctor" />
													</div>
													<input class="SpecimenSentBy" type="text" placeholder="Specimen Sent By"/>
												</div>
											</div>
										</div>-->
										
										
									</div>
									<div class="FlexDisplay FlexColumn Flex FlexBoxSizing-BorderBox Divider-Top FormArea" style="width:100%; margin:8px 0px 8px 0px;">
										<div class="FlexDisplay FlexRow Divider-Bottom" style="background:#182538;min-height:32px;max-height:32px;margin:0px 0px 2px 0px;" >
											<div style="font-size:14px; margin:0px 0px 0px 12px;">
												<i class="mdi mdi-card-account-details-star-outline" style="height:100%; color:white;" />
											</div>
											<div class="FlexDisplay Flex" style="min-width:150px;">
												<h4 class="feature-title mt-0" style="margin:8px 0px 8px 10px; font-size: 12px; font-weight:normal; line-height:16px;">Insurance</h4>
											</div>
										</div>
										
										<div class="FlexDisplay FlexRow" style="min-height:16px;max-height:16px;margin:8px 0px 0px 0px;" >
											<div class="FlexDisplay Flex" style="min-width:150px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 10px; font-size: 12px; font-weight:normal; line-height:16px;">Card Number</h4>
											</div>
											<div class="FlexDisplay Flex" style="min-width:160px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 10px; font-size: 12px; font-weight:normal; line-height:16px;">Authorization Number</h4>
											</div>
										</div>
										<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; padding:0px 8px;">						
											<div class="FlexDisplay Flex" style="min-width:150px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-smart-card-outline" />
													</div>
													<input class="InsuranceCardNumber" type="text" placeholder="Card Number"/>
												</div>
											</div>
											<div class="FlexDisplay Flex" style="min-width:160px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-smart-card-outline" />
													</div>
													<input class="InsuranceAuthorizationNumber" type="text" placeholder="Authorization Number"/>
												</div>
											</div>
										</div>
										
										<div class="FlexDisplay FlexRow" style="min-height:16px;max-height:16px;margin:8px 0px 0px 0px;" >
											<div class="FlexDisplay Flex" style="min-width:150px;">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 12px; font-size: 12px; font-weight:normal; line-height:16px;">Preliminanary Diagnosis (Code)</h4>
											</div>
											<div class="FlexDisplay Flex">
												<h4 class="feature-title mt-0" style="margin:0px 0px 0px 10px; font-size: 12px; font-weight:normal; line-height:16px; white-space: nowrap;">Final Diagnosis (Code)</h4>
											</div>
										</div>
										<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; padding:0px 8px;">						
											<div class="FlexDisplay Flex" style="min-width:150px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px;">
													<div class="icon">
														<i class="mdi mdi-microscope" />
													</div>
													<input class="InsurancePreliminanaryDiagnosisCode" type="text" placeholder="Preliminanary Diagnosis (Code)"/>
												</div>
											</div>
											<div class="FlexDisplay Flex" style="min-width:130px;">
												<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 4px;">
													<div class="icon">
														<i class="mdi mdi-microscope" />
													</div>
													<input class="InsuranceFinalDiagnosisCode" type="text" placeholder="Final Diagnosis (Code)"/>
												</div>
											</div>
										</div>
									</div>	
									
								</div>
							</div>
						</div>
					</div>
				</div>
				
			</div>
			
		</div>
	</div>
</div>
<script>
var dlg = null;
var map = null;
var scanner = null;
var mapMarkers = null;
var transitioning = false;
var currentFacility = null;
var referenceFacility = null;

$("#backBtn").unbind( "click" );
$('#backBtn').click(function(){ 
	var page = System.IO.Path.Combine("web","bhis","views",backNavigation);
	loadSubPage(System.IO.Path.Combine(System.Environment.get_CurrentDirectory(),page), true);
});

function camera_selected(item){
	if(scanner != null){
		Instascan.Camera.getCameras().then(function (cameras) {	
			var camera = cameras.filter(function(element){ return element.id == item.value;}).shift();
			if (camera != undefined && camera != null){
				scanner.start(cameras[0]);
			}
			else scanner.stop();
		})
		.catch(function (e) {
			console.error(e);
		});
	}
}

/*function previous(item){
	if(!transitioning && !$(item).hasClass('disable')){
		var section = parseInt($('.animated-sub-page.active').data("path").replace("section-",""));
		var other_section = parseInt($('.animated-sub-page').first().data("path").replace("section-",""));
		if(section>other_section){
			if(section-1 == other_section)$(item).addClass('disable');
			$('.nav-button.next').removeClass('disable');
			proceedTo(item, --section);
		}
	}
}*/

$('input[type=radio][name=gender_options]').change(function() {
	$(this).parents(".btn-group-toggle").find(".active").removeClass('active');
	$(this).parent().addClass('active');
	
	$(this).parents(".btn-group-toggle").removeClass('is-invalid');
});


function proceedTo(item, index){
		var navigateFrom = $('.animated-sub-page.active');
		var indexFrom = navigateFrom.data("path").replace("section-","");	
		
		navigateFrom.removeClass('transition-enter');
		navigateFrom.removeClass('transition-grow');
		navigateFrom.removeClass('transition-shrink');
		navigateFrom.removeClass('transition-enter-right');
		navigateFrom.removeClass('transition-enter-left');
		navigateFrom.addClass('transition-busy');
		navigateFrom.addClass('transition-shrink');
		
		setTimeout(function(){
			if(index != indexFrom){					
				var navigateTo = $(".animated-sub-pages").find(`[data-path='section-${index}']`);
											
				navigateFrom.removeClass('transition-busy');
				navigateFrom.removeClass('transition-enter');
				navigateFrom.removeClass('transition-grow');
				navigateFrom.removeClass('transition-shrink');
				navigateFrom.removeClass('transition-enter-right');
				navigateFrom.removeClass('transition-enter-left');
				if(indexFrom < index) navigateFrom.addClass('transition-leave-left');
				else navigateFrom.addClass('transition-leave-right');
				  
				navigateTo.removeClass('transition-busy');
				navigateTo.removeClass('transition-leave');
				navigateTo.removeClass('transition-grow');
				navigateTo.removeClass('transition-shrink');
				navigateTo.removeClass('transition-leave-right');
				navigateTo.removeClass('transition-leave-left');
				if(indexFrom < index) navigateTo.addClass('transition-enter-right');
				else navigateTo.addClass('transition-enter-left');
				
				navigateFrom.removeClass("active");
				navigateTo.addClass('active');
			}
			else {
				navigateFrom.one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(e) {
					navigateFrom.removeClass('transition-shrink');
					navigateFrom.removeClass('transition-grow');
				});
				
				navigateFrom.addClass('transition-grow');					
			}
		}, 500);
	}
	

function preparePagerExtension(id, column, table, callback){
	$(id).html('');
	
	var pagerList = [];
	
	/*var con = new SqlLiteConnection(System.IO.Path.Combine(getRootPath(),"databases","bhis_dict.db"),"","");
	if(con != null){
		con.open();

		var query  = "SELECT distinct ";
		query += "(case when (substr(`"+column+"` ,1,1) GLOB '*[^0-9]*') = 0 then '0_9' ";
		query += "	  else upper(substr(`"+column+"` ,1,1)) ";
		query += "end) as `Tag`  ";
		query += "FROM `"+table+"`  ";
		query += "ORDER BY `"+column+"` ";
		
		var comm = con.createCommand(query);
		if(comm != null){
			var reader = comm.executeReader();
			if(reader != null){
				while(reader.read()){
					var row = JSON.parse(reader.getValues());	
					if(row != undefined && row != null)pagerList.push(row.Tag);
				}
				reader.close();
				con.close();				
			}
			else con.close();
		}
		else con.close();
	}*/

	var pages  = '<div id="Patient_Page_0_9" class="Animation-3ms FlexDisplay Flex FlexGrow FlexRow Button NonStandard Pager '+(pagerList.includes('0_9') ? '' : 'Disabled')+'" style="height:32px;">';
		pages += '	<span class="text" style="text-align:center; display:inline-block; width:100%; font-size:11px; margin:2px 0px 0px 0px;">0-9</span>';
		pages += '</div>';
	$(id).html(pages);
	
	//if(pagerList.includes('0_9')){
	//	createPagerClickEvent('0_9', id, callback);
	//}

	for(x=65;x<65+26;x++){
		var c = String.fromCharCode(x);
		var pages = '<div id="Patient_Page_'+c+'" class="Animation-3ms FlexDisplay Flex FlexGrow FlexRow Button NonStandard Pager Divider-Left '+(pagerList.includes(c) ? '' : 'Disabled')+'" style="height:32px;">';
			pages += '	<span class="text" style="text-align:center; display:inline-block; width:100%; font-size:11px; margin:2px 0px 0px 0px;">'+c+'</span>';
			pages += '</div>';
		$(id).append(pages);
		
		//if(pagerList.includes(c)){
		//	createPagerClickEvent(c, id, callback);
		//}
	}
		
	return pagerList;
}

var patients_pagerList = preparePagerExtension("#patientsPagingBox", "FacilityName", "facilities", null);


function fetchFacility(){
	var loadedMap = false;
	var con = new SqlLiteConnection(System.IO.Path.Combine(getRootPath(),"databases","bhis_dict.db"),"","");
	if(con != null){
		con.open();

		var query  = "SELECT ";
			query += "	`ID` ";
			query += "	, `FacilityNumber` ";
			query += "	, `FacilityName` ";
			query += "	, `CommonName` ";
			query += "	, `Zone` ";
			query += "	, `Region` ";
			query += "	, `District` ";
			query += "	, `Council` ";
			query += "	, `Ward` ";
			query += "	, `VillageStreet` ";
			query += "	, `FacilityType` ";
			query += "	, `OperatingStatus` ";
			query += "	, IFNULL(`Latitude`, '') as `Latitude` ";
			query += "	, IFNULL(`Longitude`, '') as `Longitude` ";
			query += "	, `Location`  ";
			query += "	, `IsDefault`  ";
			query += "FROM `facilities` ";
			query += "WHERE `IsDefault` = '1' ";
				
		var comm = con.createCommand(query);
		if(comm != null){
			var reader = comm.executeReader();
			if(reader != null){
				if(reader.read()){
					var row = JSON.parse(reader.getValues());	
					if(row != undefined && row != null){
						map = Render({Latitude:row.Latitude,Longitude:row.Longitude});
						
						$("#facility_name_text").val(row.FacilityName);
						$("#facility_region_text").val(row.Region);
						$("#facility_district_text").val(row.District);
						$("#facility_type_text").val(row.FacilityType);
						
						loadedMap = true;
						
						currentFacility = row;
					}
				}
				reader.close();
				con.close();				
			}
			else con.close();
		}
		else con.close();
	}
	
	if(!loadedMap)map = Render({Latitude:"",Longitude:""});
}

function fetchFacilities(dlg, id, options){
	dlg.find(".FacilitiesList").html('');
	
	var _facilities = [];
	var con = new SqlLiteConnection(System.IO.Path.Combine(getRootPath(),"databases","bhis_dict.db"),"","");
	if(con != null){
		con.open();

		var query  = "SELECT ";
			query += "	`ID` ";
			query += "	, `FacilityNumber` ";
			query += "	, `FacilityName` ";
			query += "	, `CommonName` ";
			query += "	, `Zone` ";
			query += "	, `Region` ";
			query += "	, `District` ";
			query += "	, `Council` ";
			query += "	, `Ward` ";
			query += "	, `VillageStreet` ";
			query += "	, `FacilityType` ";
			query += "	, `OperatingStatus` ";
			query += "	, IFNULL(`Latitude`, '') as `Latitude` ";
			query += "	, IFNULL(`Longitude`, '') as `Longitude` ";
			query += "	, `Location`  ";
			query += "	, `IsDefault`  ";
			query += "FROM `facilities` ";
			query += "WHERE (case when (substr(`FacilityName` ,1,1) GLOB '*[^0-9]*') = 0 then '0_9' ";
			query += "	  		  else upper(substr(`FacilityName` ,1,1)) ";
			query += "	      end) = @ID";
				
		var comm = con.createCommand(query);
		if(comm != null){
			comm.addParameter("@ID", "String", id);
			var reader = comm.executeReader();
			if(reader != null){
				while(reader.read()){
					var row = JSON.parse(reader.getValues());	
					if(row != undefined && row != null)_facilities.push(row);
				}
				reader.close();
				con.close();				
			}
			else con.close();
		}
		else con.close();
	}
	
	
	loadPerViewEx(dlg, _facilities, options, 500);
	dlg.find(".FacilitiesList").scrollTop(0);
	
	dlg.find(".FacilitiesList").unbind( "scroll" );
	dlg.find(".FacilitiesList").on('scroll', function() {
		let div = $(this).get(0);				
		if(div.scrollTop + div.clientHeight == div.scrollHeight) {
			loadPerViewEx(dlg, _facilities, options, 500);
		}
	});
}

function loadPerViewEx(dlg, facilities, options, loadPerView){
	if(facilities != undefined && facilities != null && facilities.length > 0){
		let sz = (facilities.length > loadPerView ? loadPerView : facilities.length);
		for(var x=0; x<sz; x++){
			var facility = facilities.shift();
			
			var isChecked = false;
			if(options != undefined && options != null){
				if(options.FacilityNumber != undefined && options.FacilityNumber != null &&
				   options.Location != undefined && options.Location != null){
					if(facility.FacilityNumber == options.FacilityNumber && facility.Location == options.Location){
						isChecked = true;
					}
				}
			}
			
			var statusType = "mdi-map-marker";
			var statusColor = "#01579B";
			
			if(facility.Latitude == "" || facility.Longitude == ""){
				statusType = "mdi-map-marker-off";
				statusColor = "rgba(0,0,0,0.4)";
			}
			
			var operating = "mdi-help-circle";
			var operatingColor = "#4A148C";
			
			if(facility.OperatingStatus == "Closed"){
				operating = "mdi-cancel";
				operatingColor = "red";
			}
			else if(facility.OperatingStatus == "Closed (Temporary)"){
				operating = "mdi-alert-circle";
				operatingColor = "#FFD600";
			}
			else if(facility.OperatingStatus == "Operating" || facility.OperatingStatus == "Opert"){
				operating = "mdi-check-circle";
				operatingColor = "#669900";
			}
			else if(facility.OperatingStatus == "Pending Operation - Under Construction" || facility.OperatingStatus == "Pending Operation - Construction Complete"){
				operating = "mdi-clock-alert";
				operatingColor = "#C51162";
			}
			
			//var mappedType = "mdi-link-off";
			//if(item.IsMapped == "Yes")mappedType = "mdi-link";
			
			var FacilityNumber = facility.FacilityNumber;
			var Location = facility.Location;
			var Zone = facility.Zone;				
			var Region  = facility.Region;	
			var District  = facility.District;	
			var Council  = facility.Council;	
			var FacilityType  = facility.FacilityType;
			var FacilityName = facility.FacilityName;
			
			var Latitude = facility.Latitude;
			var Longitude = facility.Longitude;
			
			var IsDefault = facility.IsDefault;
			
			
			var _facility = '<div data-isdefault="'+IsDefault+'" data-facilitynumber="'+FacilityNumber+'" data-facilityname="'+FacilityName+'" data-location="'+Location+'" data-zone="'+Zone+'" data-region="'+Region+'" data-district="'+District+'" data-council="'+Council+'" data-facilitytype="'+FacilityType+'" data-latitude="'+Latitude+'" data-longitude="'+Longitude+'" class="FlexDisplay FlexRow Divider-Bottom Overflow-Hidden CheckBoxBold FacilityItem '+(isChecked ? "Checked" : "")+'" style="width:100%; min-width:100%; min-height: 32px; max-height: 32px;" >'; 
				_facility += '	<div class="FlexDisplay Divider-Right" style="min-width:32px; max-width:32px; height:100%; padding:0px 0px 0px 0px;"><span style="text-align:center; display:inline-block; width:100%;"><i class="mdi '+operating+'"></i></span></div>';
				_facility += '	<div class="FlexDisplay Divider-Right" style="min-width:32px; max-width:32px; height:100%; padding:0px 0px 0px 0px;"><span style="text-align:center; display:inline-block; width:100%; color:'+statusColor+';"><i class="mdi '+statusType+'"></i></span></div>';
				_facility += '	<div class="FacilityNumber FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; height:100%; padding:8px 0px 0px 0px;"><span style="text-align:center; display:inline-block; width:100%; font-size:11px; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">'+FacilityNumber+'</span></div>';
				_facility += '	<div class="FacilityRegion FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; width:100%; height:100%; overflow:hidden; padding:8px 8px 0px 8px; font-size:11px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1.3;">'+Region+'</span></div>';
				_facility += '	<div class="FacilityDistrict FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; width:100%; height:100%; overflow:hidden; padding:8px 8px 0px 8px; font-size:11px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1.3;">'+District+'</span></div>';
				_facility += '	<div class="FacilityType FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; width:100%; height:100%; overflow:hidden; padding:8px 8px 0px 8px; font-size:11px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1.3;">'+FacilityType+'</span></div>';
				_facility += '	<div class="FacilityName FlexDisplay" style="width:100%; height:100%; overflow:hidden; padding:8px 8px 0px 8px; font-size:11px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1.3;">'+FacilityName+'</span></div>';						
				_facility += '</div>';
			
			var el = $(_facility);
			el.unbind( "click" );
			el.click(function(){
				var item = this;
				var _FacilityNumber = $(item).children().eq(1).text();
				var _Region = $(item).children().eq(2).text();
				var _District = $(item).children().eq(3).text();
				var _FacilityType = $(item).children().eq(4).text();
				var _FacilityName = $(item).children().eq(5).text();
				
				var _Latitude = $(item).data("latitude");
				var _Longitude = $(item).data("longitude");
					
				if(map != undefined && map != null){
					if(_Latitude.toString() != "" && _Longitude != ""){
						var latlong = _Longitude+","+_Latitude;				
						var reCenter = getLatLong(latlong);	

						map.options.maxZoom = 18;
						map.eachLayer(function(layer) {
							if(layer instanceof L.TileLayer )
								layer.options.maxZoom = 18;
						});

						map.flyTo([reCenter[0]-0.000,reCenter[1]],17);
						
						mapMarkers.clearLayers();
						var marker = L.marker(reCenter);
						marker.addTo(mapMarkers);
					}
					else {
						mapMarkers.clearLayers();
						map.options.maxZoom = 2;
						map.eachLayer(function(layer) {
							if(layer instanceof L.TileLayer )
								layer.options.maxZoom = 2;
						});
						map.setView([-50.109307, 6.434463],2);
					}
				}
				
				$("#facility_name_text").val(facility.FacilityName);
				$("#facility_region_text").val(facility.Region);
				$("#facility_district_text").val(facility.District);
				$("#facility_type_text").val(facility.FacilityType);
				referenceFacility = facility;
				
				dlg.toggle();
				dlg = null;
			});

			dlg.find(".FacilitiesList").append(el);
		}
	}
}

function preparePagerEx(dlg, host, column, table, callback){
	dlg.find(host).html('');
	
	var pagerList = [];
	var con = new SqlLiteConnection(System.IO.Path.Combine(getRootPath(),"databases","bhis_dict.db"),"","");
	if(con != null){
		con.open();

		var query  = "SELECT distinct ";
		query += "(case when (substr(`"+column+"` ,1,1) GLOB '*[^0-9]*') = 0 then '0_9' ";
		query += "	  else upper(substr(`"+column+"` ,1,1)) ";
		query += "end) as `Tag`  ";
		query += "FROM `"+table+"`  ";
		query += "ORDER BY `"+column+"` ";
		
		var comm = con.createCommand(query);
		if(comm != null){
			var reader = comm.executeReader();
			if(reader != null){
				while(reader.read()){
					var row = JSON.parse(reader.getValues());	
					if(row != undefined && row != null)pagerList.push(row.Tag);
				}
				reader.close();
				con.close();				
			}
			else con.close();
		}
		else con.close();
	}

	var pages  = '<div id="Page_0_9" class="Animation-3ms FlexDisplay Flex FlexGrow FlexRow Button NonStandard Pager '+(pagerList.includes('0_9') ? '' : 'Disabled')+'" style="height:32px;">';
		pages += '	<span class="text" style="text-align:center; display:inline-block; width:100%; font-size:11px; margin:2px 0px 0px 0px;">0-9</span>';
		pages += '</div>';
	dlg.find(host).html(pages);
	
	if(pagerList.includes('0_9')){
		createPagerClickEventEx(dlg, '0_9', host, callback);
	}

	for(x=65;x<65+26;x++){
		var c = String.fromCharCode(x);
		var pages = '<div id="Page_'+c+'" class="Animation-3ms FlexDisplay Flex FlexGrow FlexRow Button NonStandard Pager Divider-Left '+(pagerList.includes(c) ? '' : 'Disabled')+'" style="height:32px;">';
			pages += '	<span class="text" style="text-align:center; display:inline-block; width:100%; font-size:11px; margin:2px 0px 0px 0px;">'+c+'</span>';
			pages += '</div>';
		dlg.find(host).append(pages);
		
		if(pagerList.includes(c)){
			createPagerClickEventEx(dlg, c, host, callback);
		}
	}
		
	return pagerList;
}

function createPagerClickEventEx(dlg, id, host, callback){
	$('#Page_'+id).removeClass('Disabled');						
	$('#Page_'+id).off("click");
	$('#Page_'+id).click(function(){
		if(!$(this).hasClass('Disabled')){
			dlg.find(host).find('.Pager').each(function(){
				$(this).removeClass('Selected');
			});
			$(this).addClass('Selected');
			
			var _id = $(this).attr('id').replace('Page_','');	
			if(callback != undefined && callback != null)callback(dlg, _id);
		}
	});
}

function clear(){
	$(".ReferenceNumber").val('');
	$(".PatientNumber").val('');
	$(".NationalID").val('');
	$(".FirstName").val('');
	$(".MiddleName").val('');
	$(".LastName").val('');
	
	$('.gender').removeClass('is-invalid');
	$('.gender').find("label").each(function(){
		$(this).removeClass('active');
	}); 
	
	$(".datepicker-range-dob").val('');
	$("#phone_number").val('');
	$(".Address").val('');
	$("#email_address").val('');

	reset_custom_dropdown(".SpecimenCondition", 'Choose...');
	reset_custom_dropdown(".SpecimenPriority", 'Choose...');
	
	$(".datepicker-range-specimen-collected").val('');
	$(".SpecimenCollectedBy").val('');
	
	$(".InsuranceCardNumber").val('');
	$(".InsuranceAuthorizationNumber").val('');
	$(".InsurancePreliminanaryDiagnosisCode").val('');
	$(".InsuranceFinalDiagnosisCode").val('');
	
	
	$(".FirstName").parent().removeClass("is-invalid");
	$(".LastName").parent().removeClass("is-invalid");
	$(".SpecimenCondition").parent().removeClass("is-invalid");
	$(".SpecimenPriority").parent().removeClass("is-invalid");
	$(".datepicker-range-dob").parent().removeClass("is-invalid");
	
	$(".FormArea").removeClass('Locked');
}

function getRequestID(){
	var index = '00001';
	
	var con = new SqlLiteConnection(System.IO.Path.Combine(getRootPath(),"databases","bhis_data.db"),"","");
	if(con != null){
		con.open();
		
		var query = "SELECT ";
			query += "	SUBSTR('00000' || (CAST(SUBSTR(`RequestID`, 14,5) as INTEGER)+1), -5, 5) `Index` ";
			query += "FROM `Reception` ";
			query += "ORDER BY CAST(SUBSTR(`RequestID`, 14,5) as INTEGER) desc ";
			query += "LIMIT 1 ";
			
		var comm = con.createCommand(query);
		if(comm != null){
			var reader = comm.executeReader();
			if(reader != null){
				if(reader.read()){
					var row = JSON.parse(reader.getValues());	
					if(row != undefined && row != null){
						index = row.Index;
					}
				}
				reader.close();
				con.close();				
			}
			else con.close();
		}
		else con.close();
	}
	
	var dt = new Date();
	var requestID = `${currentFacility.FacilityNumber}${dt.getFullYear().toString().substr(-2).padStart(2, '0')}${(dt.getMonth()+1).toString().padStart(2, '0')}-`;
	
	return requestID + index;
}

function fetchData(id){
	if(id != undefined && id != null){
		var con = new SqlLiteConnection(System.IO.Path.Combine(getRootPath(),"databases","bhis_data.db"),"","");
		if(con != null){
			con.open();
			
			var query  = "SELECT ";
				query += "	 `DateTimeStamp`";
				query += "	,`Versionstamp`";
				query += "	,`RequestID`";
				query += "	,`ReferringRequestID`";
				query += "	,`NationalID`";
				query += "	,`PatientID`";
				query += "	,`PatientName`";
				query += "	,`PatientMiddleName`";
				query += "	,`PatientLastName`";
				query += "	,`PatientAge`";
				query += "	,`HL7SexCode`";
				query += "	,`PhoneNumber`";
				query += "	,`Address`";
				query += "	,`Email`";
				query += "	,`SpecimenDateTime`";
				query += "	,`SpecimenCollectedBy`";
				query += "	,`RegisteredDateTime`";
				query += "	,`RequestingFacilityCode`";
				query += "	,`TestingFacilityCode`";
				query += "	,`RegisteredBy`";
				query += "	,`RequestTypeCode`";
				query += "	,`SpecimenCondition`";
				query += "	,`InsuranceCardNumber`";
				query += "	,`InsuranceAuthorizationNumber`";
				query += "	,`InsurancePreliminaryDiagnosisCode`";
				query += "	,`InsuranceFinalDiagnosisCode`";
				query += "FROM `Reception` ";
				query += "WHERE (`RequestID` like @ID)";
				query += "LIMIT 1 ";
				
			var comm = con.createCommand(query);
			if(comm != null){
				comm.addParameter("@ID", "String", id);
				
				var reader = comm.executeReader();
				if(reader != null){
					if(reader.read()){
						var row = JSON.parse(reader.getValues());	
						if(row != undefined && row != null){
							 
							$(".FormArea").addClass('Locked');
							
							$(".ReferenceNumber").val(row.ReferringRequestID);
							$(".PatientNumber").val(row.PatientID);
							$(".NationalID").val(row.NationalID);
							$(".FirstName").val(row.PatientName);
							$(".MiddleName").val(row.PatientMiddleName);
							$(".LastName").val(row.PatientLastName);
							
							$('.gender').removeClass('is-invalid');
							$('.gender').find("label").each(function(){
								$(this).removeClass('active');
								
								var gender = $(this).find("input").val();
								if(row.HL7SexCode == gender)$(this).addClass('active');
							}); 
							
							$(".datepicker-range-dob").val(row.PatientAge);
							$("#phone_number").val(row.PhoneNumber);
							$(".Address").val(row.Address);
							$("#email_address").val(row.Email);

							reset_custom_dropdown(".SpecimenCondition", row.SpecimenCondition);
							reset_custom_dropdown(".SpecimenPriority", row.RequestTypeCode);
							
							$(".datepicker-range-specimen-collected").val(row.SpecimenDateTime);
							$(".SpecimenCollectedBy").val(row.SpecimenCollectedBy);
							
							$(".InsuranceCardNumber").val(row.InsuranceCardNumber);
							$(".InsuranceAuthorizationNumber").val(row.InsuranceAuthorizationNumber);
							$(".InsurancePreliminanaryDiagnosisCode").val(row.InsurancePreliminaryDiagnosisCode);
							$(".InsuranceFinalDiagnosisCode").val(row.InsuranceFinalDiagnosisCode);
							
							
							$(".FirstName").parent().removeClass("is-invalid");
							$(".LastName").parent().removeClass("is-invalid");
							$(".SpecimenCondition").parent().removeClass("is-invalid");
							$(".SpecimenPriority").parent().removeClass("is-invalid");
							$(".datepicker-range-dob").parent().removeClass("is-invalid");
						}
					}
					reader.close();
					con.close();				
				}
				else con.close();
			}
			else con.close();
		}
	}
}

$("#facility_search_button").unbind( "click" );
$("#facility_search_button").click(function(){
	var facility_search_text = $("#facility_search_text").val();
	
	var content = '';
		content += '<div class="bar-container" style="margin:0px;">';
		content += '	<div class="bar-progress"></div>';
		content += '</div>';
		
		content += '<div class="FlexDisplay FlexColumn FlexBoxSizing-BorderBox" style="width:100%;">';	
		content += '	<div class="FlexDisplay FlexColumn"  style="width:100%; min-height: 24px; max-height: 24px;">';	
		content += '		<div class="FlexDisplay FlexRow Divider-Bottom Overflow-Hidden " style="width:100%; padding:0px;">';	
		content += '			<div class="FlexDisplay Divider-Right" style="min-width:32px; max-width:32px; min-height: 32px; max-height: 32px; padding:7px 0px 0px 0px;"><span style="text-align:center; display:inline-block; width:100%; font-size:9px; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;"></div>';	
		content += '			<div class="FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; min-height: 32px; max-height: 32px; padding:7px 0px 0px 0px;"><span style="text-align:center; display:inline-block; width:100%; font-size:9px; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">ID</span></div>';	
		content += '			<div class="FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; min-height: 32px; max-height: 32px; overflow:hidden; padding:7px 8px 0px 8px; font-size:9px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">REGION</span></div>';	
		content += '			<div class="FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; min-height: 32px; max-height: 32px; overflow:hidden; padding:7px 8px 0px 8px; font-size:9px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">DISTRICT</span></div>';	
		content += '			<div class="FlexDisplay Divider-Right" style="min-width:100px; max-width:100px; min-height: 32px; max-height: 32px; overflow:hidden; padding:7px 8px 0px 8px; font-size:9px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1;">TYPE</span></div>';	
		content += '			<div class="FlexDisplay" style="width:100%; min-height: 32px; max-height: 32px; overflow:hidden; padding:7px 8px 0px 8px; font-size:9px;"><span style="white-space: nowrap; width:100%; overflow:hidden; text-overflow:ellipsis; -webkit-line-clamp:1; line-height:1; text-align:left;">NAME</span></div>	';			
		content += '		</div>	';	
		content += '	</div>';	
		content += '	<div class="FlexDisplay FlexColumn FlexBoxSizing-BorderBox scroll scroll2 FacilitiesList" style="overflow-y:auto; height:240px;">';	
		
		content += '	</div>';	
		content += '	<div class="PagingBox FlexDisplay Divider-Top FlexRow" style="width:100%; min-height:32px; max-height:32px;"></div>';	
		content += '</div>';
		
		content += '</div>';


	var facility_dlg = ShowDialog('<i class="mdi mdi-hospital-marker"></i>', "Facilities", content,{
		onCloseDialog : function() {
			facility_dlg = null;
			return false; 
		}
	},"720px","720px");
	
	var pagerList = preparePagerEx($(facility_dlg.el), ".PagingBox", "FacilityName", "facilities", fetchFacilities);
	if(pagerList.length > 0){
		var fisrtID = pagerList.shift();
		$('#Page_'+fisrtID).addClass('Selected');
		fetchFacilities($(facility_dlg.el), fisrtID);
	}
	
});

$("#age-manual").unbind( "click" );
$("#age-manual").click(function(){
	var content = '';
		content += '<div class="bar-container" style="margin:0px;">';
		content += '	<div class="bar-progress"></div>';
		content += '</div>';
		
		content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; margin-top:8px; margin-bottom:8px; padding:2px 8px;">';						
		content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
		content += '			<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';
		content += '				<div class="icon">';
		content += '					<i class="mdi mdi-calendar-multiple" />';
		content += '				</div>';
		content += '				<select class="age-type">';
		content += '					<option value="years" selected="">Years</option>';
		content += '					<option value="months">Months</option>';
		content += '					<option value="days">Days</option>';
		content += '				</select>';
		content += '			</div>';
		content += '		</div>';
		content += '	</div>';
		
		content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; margin-bottom:8px; padding:2px 8px;">';						
		content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
		content += '			<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
		content += '				<div class="icon" style="padding-top:0px;">';	
		content += '					<i class="mdi mdi-calendar-question" />';	
		content += '				</div>';	
		content += '				<input type="text" onkeypress="return event.charCode >= 48 && event.charCode <= 57" placeholder="Enter Age"  class="age-input" style="padding:0px 0px 0px 8px;"/>';	
		content += '				<div class="enter-age icon btn-color Divider-Left scan"  style="border-radius: 0 0px 0px 0; padding:1px 0px 0px 1px; min-width:32px; max-width:32px;">';
		content += '					<i class="mdi mdi-calendar-multiple-check" />';
		content += '				</div>';
		content += '			</div>';
		content += '		</div>';
		content += '	</div>';
		
		
		content += '</div>';


	var age_dlg = ShowDialog('<i class="mdi mdi-calendar-account"></i>', "Age", content,{
		onCloseDialog : function() {
			age_dlg = null;
			return false; 
		}
	},"320px");	
	
	$(age_dlg.el).find(".enter-age").unbind( "click" );
	$(age_dlg.el).find(".enter-age").click(function() {
		//var _ageType = $(age_dlg.el).find(".select.age-type").val();
		var _ageType = $(age_dlg.el).find(".select-dropdown.age-type").find(".current").text();
		var _age = $(age_dlg.el).find(".age-input").val().trim();
		if(!isNaN(_age)){
			_age = parseInt(_age);
			if(_age > -1){
				
				var d = new Date();
				if(_ageType == "Years")d.setFullYear(d.getFullYear() - _age);
				else if(_ageType == "Months")d.setMonth(d.getMonth() - _age);
				else if(_ageType == "Days")d.setDate(d.getDate() - _age);
				
				dob_datepicker.selectDate(d);	
			
				age_dlg.toggle();
				age_dlg = null;
			}
		}
	});
	
	$(age_dlg.el).find(".age-input").on('change keydown paste input', function(){
		var _age = $(age_dlg.el).find(".age-input").val();
		if(_age.trim().length == 0)$(age_dlg.el).find(".age-input").parent().removeClass("is-invalid");
		else if(!isNaN(_age)){
			_age = parseInt(_age);
			if(_age > -1){
				$(age_dlg.el).find(".age-input").parent().removeClass("is-invalid");
			}
			else $(age_dlg.el).find(".age-input").parent().addClass("is-invalid");
		}
		else $(age_dlg.el).find(".age-input").parent().addClass("is-invalid");
	});
	
	create_custom_dropdowns();
	
});

$(".search").unbind( "click" );
$(".search").click(function(){
	$(".save .submenu").hide();
	$(".save").attr('id', '');
	
	$(".clear .submenu").hide();
	$(".clear").attr('id', '');
	
	if(!$(".search").hasClass("Disabled")){
		$(".search").addClass("Disabled");
		
		Instascan.Camera.getCameras().then(function (cameras) {
			var content = '';
				content += '<div class="bar-container" style="margin:0px;">';
				content += '	<div class="bar-progress"></div>';
				content += '</div>';
				
				content += '<div class="FlexDisplay FlexRow">';
					if (cameras.length > 0){
						content += '<div class="FlexDisplay FlexColumn" style="min-width:320px; max-width:320px; min-height:320px;  margin:8px 0px 4px 0px;" >';
						content += '	<div class="FlexDisplay Flex FlexRow Divider-Bottom"  style="width:100%; position:relative; padding:2px 8px;">';
						content += '		<video class="camera_preview" style="background:black; object-fit: cover; min-width:305px; max-width:305px; min-height:270px; max-height:270px"></video>';
						content += '		<div class="preloader-scan">';
						content += '			<div class="diode">';
						content += '				<div class="laser"></div>';
						content += '			</div>';
						content += '		</div>';
						content += '	</div>';

						content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; padding:2px 8px;">';						
						content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
						content += '			<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';
						content += '				<div class="icon">';
						content += '					<i class="mdi mdi-camera" />';
						content += '				</div>';
						content += '				<select class="cameras" onchange="camera_selected(this)">';
						cameras.forEach(function(element, index){
							if(index == 0)content += '					<option value="'+element.id+'" selected="">'+element.name+'</option>';
							else 		  content += '					<option value="'+element.id+'">'+element.name+'</option>';
						});
						content += '				</select>';
						content += '			</div>';
						content += '		</div>';
						content += '	</div>';
					}
					
					content += '	<div class="FlexDisplay FlexRow"  style="width:100%; height:32px; margin-top:8px; margin-bottom:8px; padding:2px 8px;">';						
					content += '		<div class="FlexDisplay Flex" style="min-width:150px;">';
					content += '			<div class="FlexDisplay Flex FlexRow form-control" style="margin:0px 4px 0px 0px; border-radius:2px; ">';	
					content += '				<div class="icon" style="padding-top:0px;">';	
					content += '					<i class="mdi mdi-badge-account-outline" />';	
					content += '				</div>';	
					content += '				<input type="text" placeholder="Request ID" class="name-id" style="padding:0px 0px 0px 8px;"/>';	
					content += '				<div class="icon btn-color Divider-Left scan"  style="border-radius: 0 0px 0px 0; padding:1px 0px 0px 1px; min-width:32px; max-width:32px;">';
					content += '					<i class="mdi mdi-magnify-scan" />';
					content += '				</div>';
					content += '			</div>';
					content += '		</div>';
					content += '	</div>';
					content += '</div>';
					
					var consultationsFor = 'Fredrick L. Mwasekaga';
					content += '<div class="FlexDisplay FlexColumn Divider-Left" style="width:100%; min-height:320px;">';
					content += '	<div class="FlexDisplay FlexRow Divider-Bottom CheckBoxBold" style="min-height:32px;">';
					content += '		<div class="FlexDisplay Flex FlexRow Divider-Right" style="min-height:32px; min-width:128px;">';
					content += '			<h4 class="feature-title mt-0" style="margin:0px 12px 0px 12px; font-size: 11px; font-weight:normal;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Consultations : '+consultationsFor+'</h4>';
					content += '		</div>';
					content += '	</div>';
					
					var consultation = '107980-52007-00001 : 2020-07-06 07:29:04';	
					content += '	<div data-id="107980-52007-00001" class="FlexDisplay FlexRow Divider-Bottom CheckBoxBold ConsultationItem" style="min-height:32px;">';
					content += '		<div class="FlexDisplay FlexRow Divider-Right" style="min-height:32px; min-width:40px; max-width:40px;">';
					content += '			<h4 class="consultationindex feature-title mt-0" style="width:100%; margin:2px 0px 0px 0px; font-size: 10px; font-weight:normal; text-align:center;">1</h4>';
					content += '		</div>';
					content += '		<div class="FlexDisplay Flex FlexRow Divider-Right" style="min-height:32px; min-width:128px;">';
					content += '			<h4 class="feature-title mt-0" style="margin:0px 12px 0px 12px; font-size: 11px; font-weight:normal;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+consultation+'</h4>';
					content += '		</div>';
					content += '	</div>';
					
					content += '</div>';
				content += '</div>';
			
			
			var search_dlg = ShowDialog('<i class="mdi mdi-account-group"></i>', "Search", content,{
				onCloseDialog : function() {
					if(scanner != null){
						scanner.stop();
						scanner = null;
						search_dlg = null;
					}
					$(".search").removeClass("Disabled");
					return false; 
				}
			},"720px","720px","720px");	
			
			if (cameras.length > 0){
				scanner = new Instascan.Scanner({
					continuous: true,
					video: $(search_dlg.el).find(".camera_preview").get(0),
					mirror: true,
					captureImage: false,
					backgroundScan: true,
					refractoryPeriod: 5000,
					scanPeriod: 1
				});
				scanner.addListener('scan', function (content) {
					if(content != undefined && content != null){
						
						
						scanner.stop();
						search_dlg.toggle();		
						scanner = null;
						search_dlg = null;
					}		
				});
				
				create_custom_dropdowns();
				scanner.start(cameras[0]);
			}
			
			$(search_dlg.el).find(".ConsultationItem").each(function(i){
				$(this).unbind( "click" );
				$(this).click(function() {
					var requestID = $(this).data('id');
					if(!isEmpty(requestID)){
						fetchData(requestID);
						
						search_dlg.toggle();
						search_dlg = null;
					}
				});	
				
				
			});

			$(search_dlg.el).find(".scan").unbind( "click" );
			$(search_dlg.el).find(".scan").click(function() {
				//var result = scanner.scan();
				//console.log(result);
				//console.log(result.content);
				//console.log(result.image);
				
				
				var val = $(".name-id").val();
				fetchData(val); //107980-52007-00001
				
				search_dlg.toggle();
				search_dlg = null;
			});		
		})
		.catch(function (e) {
			console.error(e);
		});
	}
});

$(".clear").unbind( "click" );
$(".clear").click(function(){	
	$(".search .submenu").hide();
	$(".search").attr('id', '');
	
	$(".save .submenu").hide();
	$(".save").attr('id', '');
	
	clear();
});

$(".save").unbind( "click" );
$(".save").click(function(){	
	$(".search .submenu").hide();
	$(".search").attr('id', '');
	
	$(".clear .submenu").hide();
	$(".clear").attr('id', '');
	
	var ReferenceNumber = $(".ReferenceNumber").val();
	var PatientNumber = $(".PatientNumber").val();
	var NationalID = $(".NationalID").val();
	var FirstName = $(".FirstName").val();
	var MiddleName = $(".MiddleName").val();
	var LastName = $(".LastName").val();
	
	var Gender = $('.gender').find("label.active input").val();
	
	var DateOfBirth = $(".datepicker-range-dob").val();
	var PhoneNumber = $("#phone_number").val();
	var Address = $(".Address").val();
	var EmailAddress = $("#email_address").val();

	var SpecimenCondition = $(".SpecimenCondition").val();
	var SpecimenPriority = $(".SpecimenPriority").val();
	var SpecimenCollectedDate = $(".datepicker-range-specimen-collected").val();
	var SpecimenCollectedBy = $(".SpecimenCollectedBy").val();
	
	var InsuranceCardNumber = $(".InsuranceCardNumber").val();
	var InsuranceAuthorizationNumber = $(".InsuranceAuthorizationNumber").val();
	var InsurancePreliminanaryDiagnosisCode = $(".InsurancePreliminanaryDiagnosisCode").val();
	var InsuranceFinalDiagnosisCode = $(".InsuranceFinalDiagnosisCode").val();
	
	
			
	if(currentFacility != undefined && currentFacility != null &&
	   (Gender != undefined && Gender != null) &&
	   (FirstName != undefined && FirstName != null && FirstName.trim().length > 0) &&
	   (LastName != undefined && LastName != null && LastName.trim().length > 0) &&
	   (SpecimenCondition != undefined && SpecimenCondition != null && SpecimenCondition != "Choose...") &&
	   (SpecimenPriority != undefined && SpecimenPriority != null && SpecimenPriority != "Choose...") &&
	   (DateOfBirth != undefined && DateOfBirth != null && DateOfBirth.trim().length > 0)
	   ){
			var dt = new Date();
			var dateTimeStamp = `${dt.getFullYear().toString().padStart(4, '0')}-${(dt.getMonth()+1).toString().padStart(2, '0')}-${dt.getDate().toString().padStart(2, '0')}`;
			dateTimeStamp += ` ${dt.getHours().toString().padStart(2, '0')}:${dt.getMinutes().toString().padStart(2, '0')}:${dt.getSeconds().toString().padStart(2, '0')}`;
			var requestID = getRequestID();
			var registeredBy = 'Sys';
				
				
			var con = new SqlLiteConnection(System.IO.Path.Combine(getRootPath(),"databases","bhis_data.db"),"","");
			if(con != null){
				con.open();
				
				var query = "INSERT INTO `Reception`(";
					query += "	`DateTimeStamp`";
					query += "	,`Versionstamp`";
					query += "	,`RequestID`";
					if(!isEmpty(ReferenceNumber))query += "	,`ReferringRequestID`";
					if(!isEmpty(NationalID))query += "	,`NationalID`";
					if(!isEmpty(PatientNumber))query += "	,`PatientID`";
					query += "	,`PatientName`";
					if(!isEmpty(MiddleName))query += "	,`PatientMiddleName`";
					query += "	,`PatientLastName`";
					query += "	,`PatientAge`";
					query += "	,`HL7SexCode`";
					if(!isEmpty(PhoneNumber))query += "	,`PhoneNumber`";
					if(!isEmpty(Address))query += "	,`Address`";
					if(!isEmpty(EmailAddress))query += "	,`Email`";
					if(!isEmpty(SpecimenCollectedDate))query += "	,`SpecimenDateTime`";
					if(!isEmpty(SpecimenCollectedBy))query += "	,`SpecimenCollectedBy`";
					query += "	,`RegisteredDateTime`";
					query += "	,`RequestingFacilityCode`";
					query += "	,`TestingFacilityCode`";
					query += "	,`RegisteredBy`";
					query += "	,`RequestTypeCode`";
					query += "	,`SpecimenCondition`";
					if(!isEmpty(InsuranceCardNumber))query += "	,`InsuranceCardNumber`";
					if(!isEmpty(InsuranceAuthorizationNumber))query += "	,`InsuranceAuthorizationNumber`";
					if(!isEmpty(InsurancePreliminanaryDiagnosisCode))query += "	,`InsurancePreliminaryDiagnosisCode`";
					if(!isEmpty(InsuranceFinalDiagnosisCode))query += "	,`InsuranceFinalDiagnosisCode`";
					query += ") VALUES (";
					query += "	@DateTimeStamp";
					query += "	,@Versionstamp";
					query += "	,@RequestID";
					if(!isEmpty(ReferenceNumber))query += "	,@ReferringRequestID";
					if(!isEmpty(NationalID))query += "	,@NationalID";
					if(!isEmpty(PatientNumber))query += "	,@PatientID";
					query += "	,@PatientName";
					if(!isEmpty(MiddleName))query += "	,@PatientMiddleName";
					query += "	,@PatientLastName";
					query += "	,@PatientAge";
					query += "	,@HL7SexCode";
					if(!isEmpty(PhoneNumber))query += "	,@PhoneNumber";
					if(!isEmpty(Address))query += "	,@Address";
					if(!isEmpty(EmailAddress))query += "	,@Email";
					if(!isEmpty(SpecimenCollectedDate))query += "	,@SpecimenDateTime";
					if(!isEmpty(SpecimenCollectedBy))query += "	,@SpecimenCollectedBy";
					query += "	,@RegisteredDateTime";
					query += "	,@RequestingFacilityCode";
					query += "	,@TestingFacilityCode";
					query += "	,@RegisteredBy";
					query += "	,@RequestTypeCode";
					query += "	,@SpecimenCondition";
					if(!isEmpty(InsuranceCardNumber))query += "	,@InsuranceCardNumber";
					if(!isEmpty(InsuranceAuthorizationNumber))query += "	,@InsuranceAuthorizationNumber";
					if(!isEmpty(InsurancePreliminanaryDiagnosisCode))query += "	,@InsurancePreliminaryDiagnosisCode";
					if(!isEmpty(InsuranceFinalDiagnosisCode))query += "	,@InsuranceFinalDiagnosisCode";
					query += ")";
					
				var comm = con.createCommand(query);
				if(comm != null){
					comm.addParameter("@DateTimeStamp", "String", dateTimeStamp);
					comm.addParameter("@Versionstamp", "String", getVersion().toString());
					comm.addParameter("@RequestID", "String", requestID);
					if(!isEmpty(ReferenceNumber))comm.addParameter("@ReferringRequestID", "String", ReferenceNumber);
					if(!isEmpty(NationalID))comm.addParameter("@NationalID", "String", NationalID);
					if(!isEmpty(PatientNumber))comm.addParameter("@PatientID", "String", PatientNumber);
					comm.addParameter("@PatientName", "String", FirstName);
					if(!isEmpty(MiddleName))comm.addParameter("@PatientMiddleName", "String", MiddleName);
					comm.addParameter("@PatientLastName", "String", LastName);
					comm.addParameter("@PatientAge", "String", DateOfBirth);
					comm.addParameter("@HL7SexCode", "String", Gender);
					if(!isEmpty(PhoneNumber))comm.addParameter("@PhoneNumber", "String", PhoneNumber);
					if(!isEmpty(Address))comm.addParameter("@Address", "String", Address);
					if(!isEmpty(EmailAddress))comm.addParameter("@Email", "String", EmailAddress);
					if(!isEmpty(SpecimenCollectedDate))comm.addParameter("@SpecimenDateTime", "String", SpecimenCollectedDate);
					if(!isEmpty(SpecimenCollectedBy))comm.addParameter("@SpecimenCollectedBy", "String", SpecimenCollectedBy);
					comm.addParameter("@RegisteredDateTime", "String", dateTimeStamp);
					comm.addParameter("@RequestingFacilityCode", "String", (referenceFacility != undefined && referenceFacility != null ? referenceFacility.FacilityNumber : currentFacility.FacilityNumber));
					comm.addParameter("@TestingFacilityCode", "String", currentFacility.FacilityNumber);
					comm.addParameter("@RegisteredBy", "String", registeredBy);
					comm.addParameter("@RequestTypeCode", "String", SpecimenPriority);
					comm.addParameter("@SpecimenCondition", "String", SpecimenCondition);
					if(!isEmpty(InsuranceCardNumber))comm.addParameter("@InsuranceCardNumber", "String", InsuranceCardNumber);
					if(!isEmpty(InsuranceAuthorizationNumber))comm.addParameter("@InsuranceAuthorizationNumber", "String", InsuranceAuthorizationNumber);
					if(!isEmpty(InsurancePreliminanaryDiagnosisCode))comm.addParameter("@InsurancePreliminaryDiagnosisCode", "String", InsurancePreliminanaryDiagnosisCode);
					if(!isEmpty(InsuranceFinalDiagnosisCode))comm.addParameter("@InsuranceFinalDiagnosisCode", "String", InsuranceFinalDiagnosisCode);
				
					comm.executeNonQuery();
				}
				
				con.close();
			}
			
			
			
			
	}
	else{
	
		if(FirstName != undefined && FirstName != null && FirstName.trim().length == 0){
			$(".FirstName").parent().addClass("is-invalid");
			$('.FirstName').focus(function(){ $(this).parent().removeClass("is-invalid"); });
		}
		
		if(LastName != undefined && LastName != null && LastName.trim().length == 0){
			$(".LastName").parent().addClass("is-invalid");
			$('.LastName').focus(function(){ $(this).parent().removeClass("is-invalid"); });
		}
		
		if(SpecimenCondition != undefined && SpecimenCondition != null && SpecimenCondition == "Choose..."){
			$(".SpecimenCondition").parent().addClass("is-invalid");
			$('.SpecimenCondition').focus(function(){ $(this).parent().removeClass("is-invalid"); });
		}
		
		if(SpecimenPriority != undefined && SpecimenPriority != null && SpecimenPriority == "Choose..."){
			$(".SpecimenPriority").parent().addClass("is-invalid");
			$('.SpecimenPriority').focus(function(){ $(this).parent().removeClass("is-invalid"); });
		}
		
		if(DateOfBirth != undefined && DateOfBirth != null && DateOfBirth.trim().length == 0){
			$(".datepicker-range-dob").parent().addClass("is-invalid");
		}
		
		if (Gender == undefined || Gender == null){
			$('.gender').addClass("is-invalid");
		}
		
	}
	
});

function getLatLong(data){
	if(data == undefined) return null;
	var d = data.split(",");
	return [d[1], d[0]];
}

function Render(item){
	var maxZoom = 2;
	var latlong = "";

	if(item.Latitude != ""){
		latlong = item.Longitude+","+item.Latitude;	
		maxZoom = 18;
	}

	L.Icon.Default.imagePath = "images/";

	mapMarkers = new L.LayerGroup();
	var _map = L.map('mapid', { zoomControl:false, layers: [mapMarkers] });	
	//var layer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
	var layer = L.tileLayer('/openstreetmap/BLIS 3.6/{s}/{z}/{x}/{y}', { //Using an extension to allow User-Agent to be passed
		maxZoom: maxZoom,
		minZoom: 2,
		attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
		id: 'mapbox.streets'
	});
	
	
	/*},
	new Headers({"User-Agent": "BLIS 3.6"}),
    null);*/
	
	layer.addTo(_map);
	
	//L.layerGroup([marker1, marker2])
    //.addLayer(polyline)
    //.addTo(map);

	if(item.Latitude != ""){
		var reCenter = getLatLong(latlong);	
		_map.setView([reCenter[0],reCenter[1]],17);
	
		var marker = L.marker(reCenter);
		marker.addTo(mapMarkers);
		//mapMarker.bindPopup("works");
	}
	else {
		//_map.setView([-50.109307, 18.434463],2);
		_map.setView([0.35156, 20.742188],2);
		//map.setView([0,0],2);
		//map.panTo([0,0]);
	}

	//map.on("moveend", function () {
	//  console.log(map.getCenter().toString());
	//});
	
	$('.leaflet-control-attribution').html('<span style="pointer-events: none;"><u style="color:#0078A8;">Leaflet</u> | &copy; <u style="color:#0078A8;">OpenStreetMap</u> contributors</span>');
	
	/*_map.on('dragend', function onDragEnd(){
		var width = _map.getBounds().getEast() - _map.getBounds().getWest();
		var height = _map.getBounds().getNorth() - _map.getBounds().getSouth();

		console.log (
			'center:' + _map.getCenter() +'\n'+
			'width:' + width +'\n'+
			'height:' + height +'\n'+
			'size in pixels:' + _map.getSize()
		)
	});*/
	
	return _map;
}

var dateOptions = {language: 'en' ,dateFormat: 'yyyy-mm-dd' /*,range:true ,multipleDatesSeparator:" - " ,toggleSelected: false */ };

var dob_datepicker = InitDatePicker($('.datepicker-range-dob'), dateOptions);

var specimen_collected_datepicker_dateTimeOptions 	= {language: 'en' ,dateFormat: 'yyyy-mm-dd' ,timepicker: true, timeFormat: 'hh:ii', position: "top left", maxDate:new Date() /*,range:true ,multipleDatesSeparator:" - " ,toggleSelected: false */ };

specimen_collected_datepicker_dateTimeOptions.onSelect = function(formattedDate, date, inst){
	var dt = $('.datepicker-range-specimen-collected').val();
	if(dt.trim().length > 0){
		var specimen_collected_datetime = getDateTime('.datepicker-range-specimen-collected');
	}
}

var specimen_collected_datepicker = InitDatePicker($('.datepicker-range-specimen-collected'), specimen_collected_datepicker_dateTimeOptions);

focusEvents($('.datepicker-range-dob'),
	function(){
		$(this).parent().removeClass("is-invalid");
	},
	function(){
		var val = $(this).val();
		if(val.trim().length > 0){
			if (/([12]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01]))/im.test(val.trim())){
				$(this).parent().removeClass("is-invalid");
			}
			else $(this).parent().addClass("is-invalid");
		}
		else $(this).parent().removeClass("is-invalid");
	}
);

focusEvents($('#phone_number'),
	function(){
		$(this).parent().removeClass("is-invalid");
	},
	function(){
		var val = $(this).val();
		if(val.trim().length > 0){
			if (/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test(val.trim())){
				$(this).parent().removeClass("is-invalid");
			}
			else $(this).parent().addClass("is-invalid");
		}
		else $(this).parent().removeClass("is-invalid");
	}
);

focusEvents($('#email_address'),
	function(){
		$(this).parent().removeClass("is-invalid");
	},
	function(){
		var val = $(this).val();
		if(val.trim().length > 0){
			if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(val.trim())){
				$(this).parent().removeClass("is-invalid");
			}
			else $(this).parent().addClass("is-invalid");
		}
		else $(this).parent().removeClass("is-invalid");
	}
);

fetchFacility();

hideNavigationDropMenu();

closeLoadingPage();
</script>